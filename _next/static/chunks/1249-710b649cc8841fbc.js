"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1249],{70974:function(e,t,i){var n=i(67294),r=i(73935),o=i(12464),a=i(13433),s=i(60864),l=i(85893);t.Z=e=>{let{node:t,dragPosition:i,scaleToPage:d,containerZIndex:c}=e;const{0:u,1:p}=(0,n.useState)(null),g=(0,a.l)(s.k6),{x:h,y:f}=i||{x:0,y:0};return(0,n.useEffect)((()=>{const e=[`translate(${h}px, ${f}px)`];d&&e.push(`scale(${g})`);const t=document.createElement("div");return t.style.cssText=`\n      position: absolute;\n      top: 0;\n      left: 0;\n\n      pointer-events: none;\n      transform: ${e.join(" ")};\n\n      ${Number.isInteger(c)?`z-index: ${c};`:""}\n    `,p(t),document.body.appendChild(t),()=>{document.body.removeChild(t)}}),[c,g,d,h,f]),u?(0,r.createPortal)((0,l.jsx)(o.t0,{node:t}),u):null}},17009:function(e,t,i){i.d(t,{DY:function(){return s},_v:function(){return l},lr:function(){return d},mP:function(){return o},pf:function(){return a}});var n=i(59016),r=i(13285);const o=n.ZP.div.withConfig({displayName:"Tooltipstyles__TooltipDisplayWrapper",componentId:"sc-1brwmgd-0"})([""]),a=n.ZP.div.withConfig({displayName:"Tooltipstyles__TooltipWrapper",componentId:"sc-1brwmgd-1"})(["display:inherit;flex-direction:inherit;"]),s=(0,n.ZP)(r.E.div).withConfig({displayName:"Tooltipstyles__TooltipContainer",componentId:"sc-1brwmgd-2"})(["position:absolute;white-space:nowrap;width:fit-content;"]),l=n.ZP.div.withConfig({displayName:"Tooltipstyles__TooltipContent",componentId:"sc-1brwmgd-3"})(["border-radius:6px;background:",";color:",";",";font-weight:500;font-size:","px;padding:6px;box-shadow:",";"],(e=>e.$background??"transparent"),(e=>e.theme.colors.tooltipTextColor),(e=>e.$background&&"backdrop-filter: blur(100px)"),12,(e=>{let{theme:t,$background:i}=e;return i?t.boxShadow.large:"none"})),d=n.ZP.span.withConfig({displayName:"Tooltipstyles__TooltipShortcut",componentId:"sc-1brwmgd-4"})(["background:",";height:16px;width:fit-content;min-width:16px;line-height:17px;display:inline-block;border-radius:2px;text-align:center;margin-left:8px;font-size:","px;"],(e=>e.theme.colors.tooltipShortcutBg),12)},71515:function(e,t,i){var n=i(59499),r=i(67294),o=i(73935),a=i(95421),s=i(50576),l=i(13270),d=i(59016),c=i(53098),u=i(17009),p=i(85893);function g(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?g(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.Z=e=>{const{children:t,content:i,perpendicularOffset:n=0,placement:g="left",shortcuts:f,delay:m=200,offset:y=10,ignoreWrapper:v=!1,style:w,withBackground:b=!0,background:I,zIndex:P=c.Ue,tooltipStyle:x}=e,{0:T,1:O}=(0,r.useState)(!1),R=(0,d.Fg)(),{0:C,1:j}=(0,r.useState)({}),{0:E,1:S}=(0,r.useState)(),{0:D,1:_}=(0,r.useState)([]),k=(0,r.useRef)(),A=(0,r.useMemo)((()=>({x:"top",y:"top"})),[]),Z={},L=b?I||R.colors.tooltipBg:void 0;Z.zIndex=P;const H={},M={},z={};switch(g){case"top":case"bottom":Z.left="50%",Z.transform="translateX(-50%)";break;case"right":case"left":Z.top="50%",Z.transform="translateY(-50%)"}switch(g){case"top":A.x="left",A.y="bottom";break;case"bottom":case"right":A.x="left",A.y="top";break;default:A.x="right",A.y="top"}(0,r.useEffect)((()=>()=>{k.current&&clearTimeout(k.current)}),[]);const N=(0,r.useCallback)((e=>{switch(g){case"right":return e.right+y;case"left":return window.innerWidth-e.left+y;default:return e.x+e.width/2+n}}),[g,y,n]),U=(0,r.useCallback)((e=>{switch(g){case"bottom":return e.bottom+y;case"top":return window.innerHeight-e.top+y;default:return e[A.y]+e.height/2+n}}),[g,A,y,n]),$=(0,r.useCallback)((t=>{const i=t.currentTarget.dataset.tooltipId;if(z[i]||e.tooltipDisabled)return;const n=H[i];let r;n&&(r=n());const o=M[i];S((e=>e!==r?r:e)),_((e=>(0,s.Z)(e,o)?e:o||[])),k.current&&clearTimeout(k.current),k.current=setTimeout((()=>{O((e=>e||!0))}),m);const a=t.currentTarget.getBoundingClientRect(),l=N(a),d=U(a);j((e=>e&&e[A.y]===d&&e[A.x]===l?e:{[A.y]:d,[A.x]:l}))}),[A,H,z]),W=(0,r.useCallback)((()=>{k.current&&clearTimeout(k.current),O((e=>!e&&e))}),[k]),F=(0,r.useCallback)((()=>{k.current&&clearTimeout(k.current),O((e=>!e&&e))}),[k]);(0,r.useEffect)((()=>(window.addEventListener("keydown",F),()=>{window.removeEventListener("keydown",F)})),[F]);const V=r.Children.map(t,(e=>{if(v){const t=r.Children.map(e.props.children,(e=>{const t=e;return r.isValidElement(t)?(0,p.jsx)(l.yF,{children:(t,i)=>{const n=e.key?i(e.key):t;H[n]=e.props.renderTooltip,M[n]=e.props.tooltipShortcuts,z[n]=e.props.disableTooltip;return(0,r.cloneElement)(e,h({"data-tooltip-id":n,onMouseOver:$},e.props))}}):e}));return(0,r.cloneElement)(e,h(h({},e.props),{},{children:t}))}return r.isValidElement(e)?(0,p.jsx)(l.yF,{children:(t,i)=>{const n=e.key?i(e.key):t;H[n]=e.props.renderTooltip,M[n]=e.props.tooltipShortcuts,z[n]=e.props.disableTooltip;return(0,r.cloneElement)(e,h({"data-tooltip-id":n,onMouseOver:$},e.props))}}):e})),B=i||E,J=f||D||[];let G;return G=document.body,(0,p.jsxs)(u.pf,{onMouseLeave:()=>{k.current&&clearTimeout(k.current),O(!1),j({})},onMouseDown:W,style:w,children:[(0,p.jsx)(l.Ot,{children:V}),(0,p.jsx)(a.M,{children:T&&C&&B&&(0,p.jsx)(u.mP,{children:G&&(0,o.createPortal)((0,p.jsx)(u.DY,{initial:{opacity:0,[A.x]:C[A.x],[A.y]:C[A.y]},animate:{opacity:1,[A.x]:C[A.x],[A.y]:C[A.y]},exit:{opacity:0,transition:{duration:0}},transition:{duration:.2,ease:[.4,0,.1,1]},style:Z,children:(0,p.jsxs)(u._v,{$background:L,style:x,children:[B,J.map((e=>(0,p.jsx)(u.lr,{children:e},e)))]})}),G)})})]})}},74591:function(e,t,i){i.d(t,{mA:function(){return dt},pu:function(){return lt},R6:function(){return st},ZP:function(){return ut}});var n=i(59499),r=i(13433),o=i(13285),a=i(67294),s=i(4480),l=i(59016),d=i(1922),c=i(78963),u=i(24656),p=i(22817),g=i(97210),h=i(24418),f=i(60864),m=i(57509),y=i(37189);const v=/--.*[^)]/;var w=()=>{const e=(0,a.useCallback)(((e,t)=>{var i;return e.getPropertyValue((null===(i=t.match(v))||void 0===i?void 0:i[0])??t)}),[]);return{getComputedColors:(0,a.useCallback)(((t,i)=>{let n=[];if(t.current){const r=getComputedStyle(t.current);n=i.map((t=>e(r,t)))}return n}),[e])}},b=i(55204),I=i(98982),P=i(31678),x=i(40761),T=i(89202),O=i(83887),R=i(27453),C=i(64310),j=i(13181),E=i(27618),S=i(46253),D=i(40105),_=i(37865),k=i(4034),A=i(90170),Z=i(17463),L=i(92853),H=i(51718),M=i(95821);var z=l.vJ`
// A powerful override that can remove the cursor
body, body * {
  cursor: none !important;
  user-select: none !important;
  -webkit-user-select: none !important;
}
`,N=i(92627),U=i(88989);let $;!function(e){e.ACTIVE="active",e.SHOW="show",e.HIDE="hide",e.ALERT="alert",e.ALERT_HIDE="alert hide"}($||($={}));const W={[$.ACTIVE]:{opacity:.25,transition:{duration:0}},[$.SHOW]:{opacity:.2,transition:{duration:0}},[$.HIDE]:{opacity:0,transition:{duration:.2}},[$.ALERT]:{opacity:1,transition:{duration:0}},[$.ALERT_HIDE]:{opacity:0,transition:{duration:0}}};var F=i(78374);const V=(0,l.ZP)(o.E.div).withConfig({displayName:"Resizestyles__Target",componentId:"sc-1ibc3e6-0"})(["display:grid;place-items:center;position:absolute;",""],(e=>{let{$variant:t}=e;switch(t){case"vertical":return"\n          cursor: ew-resize;\n        ";case"horizontal":return"\n          cursor: ns-resize;\n          height: 100%;\n          width: 100%;\n        ";default:return""}})),B=l.ZP.div.attrs((e=>{const t={borderRadius:e.$pagePadding/2};switch(e.$variant){case"vertical":t.height="56px",t.width="4px";break;case"horizontal":t.width="50%",t.height="4px"}return{style:t}})).withConfig({displayName:"Resizestyles__Handle",componentId:"sc-1ibc3e6-1"})(["background:",";pointer-events:none;"],(e=>{let{theme:t,$alert:i}=e;return i?t.colors.red:t.colors.resizeHandle})),J=l.ZP.div.withConfig({displayName:"Resizestyles__TooltipTarget",componentId:"sc-1ibc3e6-2"})(["width:","px;display:flex;justify-content:center;pointer-events:",";"],(e=>{let{pagePadding:t}=e;return 2*t}),(e=>{let{enabled:t}=e;return t?"auto":"none"}));var G=i(85893);var Y=e=>{let{onResizeStart:t,onResize:i,onResizeComplete:n,enabled:r,pagePadding:o,stackedPageRef:l}=e;const{0:d,1:c}=(0,a.useState)(!1),{scrollingPageRef:u}=(0,a.useContext)(N.Z),p=(0,s.Zl)(F.lk),{scrollContainerIfNeeded:g,cancelAnyScrolling:h}=(0,U.Z)({delayMs:60}),f=(0,a.useRef)(0),m=(0,a.useRef)(0),y=(0,a.useRef)(0),v=(0,a.useRef)(0),w=(0,a.useRef)(0),b=(0,a.useRef)(i);b.current=i;const I=(0,a.useRef)(n);I.current=n;const P=(0,a.useCallback)((()=>{const e=u.current.scrollHeight;e>w.current&&(w.current=e),l.current&&(l.current.style.height=`${w.current}px`)}),[u,l]),x=(0,a.useCallback)((e=>{P(),g(e);const t=e.pageY-f.current;y.current=t,b.current(y.current+v.current)}),[P,g]),T=(0,a.useCallback)((()=>{P();const e=u.current.scrollTop-m.current;v.current=e,b.current(y.current+v.current)}),[P,u]),O=(0,a.useCallback)((()=>{u.current.removeEventListener("scroll",T),window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",O),h(),I.current(),c(!1),p(!1),y.current=0,v.current=0,w.current=0,l.current&&(l.current.style.height="auto",l.current.style.transition="none")}),[h,x,T,u,p,l]),R=(0,a.useCallback)((e=>{c(!0),p(!0),e.preventDefault(),t(),f.current=e.pageY,m.current=u.current.scrollTop,u.current.addEventListener("scroll",T),window.addEventListener("mousemove",x),window.addEventListener("mouseup",O),g(e)}),[t,u,T,x,O,g,p]);return(0,G.jsxs)(V,{$variant:"horizontal","data-testid":"row_resize_handle",variants:W,initial:$.HIDE,whileHover:d?$.ACTIVE:$.SHOW,animate:d?$.ACTIVE:$.HIDE,style:{pointerEvents:r?"auto":"none"},onMouseDown:R,children:[(0,G.jsx)(B,{$variant:"horizontal",$pagePadding:o,$alert:!1}),d&&(0,G.jsx)(z,{})]})};const K=l.ZP.div.withConfig({displayName:"HorizontalPageRowGutter__Container",componentId:"sc-1a3d399-0"})(["position:relative;width:100%;"]);var q=e=>{let{children:t,style:i}=e;return(0,G.jsx)(K,{style:i,children:t})},X=i(67156),Q=i(40556),ee=i(20543),te=i(53098);var ie=e=>{let{children:t,as:i,indicatorTargetId:n,style:r={},onDrop:o,dataTestId:l}=e;const d=(0,s.Zl)((0,F.fz)(n)),c=(0,s.Zl)(F.M9),u=(0,a.useCallback)((e=>{e.preventDefault(),d(!0),c(n)}),[n,c,d]),p=(0,a.useCallback)((e=>{e.preventDefault(),d(!0),c(n)}),[n,c,d]),g=(0,a.useCallback)((e=>{e.preventDefault(),d(!1),c(null)}),[c,d]),h=(0,s._8)((e=>{let{snapshot:t}=e;return e=>{if(e.preventDefault(),d(!1),c(null),"function"===typeof o){const i=t.getLoadable(F.LY).getValue();o({e:e,dndData:i})}}}),[d,c,o]);return(0,G.jsx)(i,{"data-testid":l,onMouseEnter:u,onMouseOver:p,onMouseLeave:g,onPointerUp:h,onDragEnter:u,onDragLeave:g,onDragOver:p,onDrop:h,style:r,children:t})};const ne=(0,l.ZP)(o.E.div).withConfig({displayName:"DropZoneIndicator__Indicator",componentId:"sg23uz-0"})(["background-color:",";border-radius:99px;position:absolute;"],(e=>e.theme.colors.contentAccent)),re=(0,l.ZP)(ne).withConfig({displayName:"DropZoneIndicator__VerticalIndicator",componentId:"sg23uz-1"})(["width:","px;height:100%;"],X.cn),oe=(0,l.ZP)(ne).withConfig({displayName:"DropZoneIndicator__HorizontalIndicator",componentId:"sg23uz-2"})(["height:","px;width:calc(100% - ","px);"],X.cn,X.j);var ae=e=>{let{indicatorId:t,dataTestId:i,style:n,orientation:r}=e;const o=(0,s.sJ)((0,F.fz)(t));let a;switch(r){case"horizontal":a=oe;break;case"vertical":a=re}return(0,G.jsx)(a,{"data-testid":i,style:n,initial:{opacity:0},transition:{duration:.15,type:"tween"},animate:{opacity:o?1:0}})},se=i(44588);function le(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function de(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?le(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):le(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const ce=l.ZP.div.withConfig({displayName:"RowHorizontalDropZone__Container",componentId:"sc-1okr71w-0"})(["position:absolute;width:100%;"]),ue=l.ZP.div.withConfig({displayName:"RowHorizontalDropZone__StyledDropZone",componentId:"sc-1okr71w-1"})(["position:absolute;z-index:",";left:-","px;"],te.xG,1.5*X.j);var pe=e=>{let{indicatorId:t,onDrop:i,enabled:n,indicatorStyle:r,dropzoneStyle:o,displayIndicator:a,debugMode:s}=e;return(0,se.Z)()&&n||s?(0,G.jsxs)(ce,{children:[(a||s)&&(0,G.jsx)(ae,{style:r,indicatorId:t,dataTestId:"flexitome_row_dropzone_indicator",orientation:"horizontal"}),(0,G.jsx)(ie,{as:ue,dataTestId:"flexitome_row_dropzone",indicatorTargetId:t,onDrop:i,style:de(de({},o),s?{background:"rgba(255, 100, 100, 0.7)"}:{})})]}):null};const ge=(0,l.ZP)(o.E.div).withConfig({displayName:"TileDropZoneIndicator__Container",componentId:"sc-1huhnb7-0"})(["border-radius:","px;width:100%;height:100%;background-color:",";position:absolute;z-index:",";"],(e=>{let{radius:t}=e;return t}),(e=>e.theme.colors.tileDropBackground),te.K5),he=l.ZP.div.withConfig({displayName:"TileDropZoneIndicator__Overlay",componentId:"sc-1huhnb7-1"})(["width:100%;height:100%;display:flex;flex-direction:row;align-items:center;justify-content:center;background-color:",";"],(e=>e.theme.colors.tileDropBackgroundOverlay)),fe=l.ZP.div.withConfig({displayName:"TileDropZoneIndicator__Label",componentId:"sc-1huhnb7-2"})(["font-size:17px;color:",";"],(e=>e.theme.colors.tileDropText));var me=e=>{let{indicatorId:t,radius:i}=e;const{t:n}=(0,d.$G)(),r=(0,s.sJ)((0,F.fz)(t));return(0,G.jsx)(ge,{initial:{opacity:0},transition:{duration:.15,type:"tween"},animate:{opacity:r?1:0},radius:i,children:(0,G.jsx)(he,{children:(0,G.jsx)(fe,{children:n("tiles.dropToUpload")})})})};function ye(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function ve(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ye(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const we=l.ZP.div.withConfig({displayName:"VerticalDropZone__Container",componentId:"ife6na-0"})(["position:relative;visibility:",";"],(e=>e.$dragInProgress?"visible":"hidden")),be=l.ZP.div.withConfig({displayName:"VerticalDropZone__DropZoneContainer",componentId:"ife6na-1"})(["position:absolute;left:0;width:100%;"]),Ie=l.ZP.div.withConfig({displayName:"VerticalDropZone__StyledDropZone",componentId:"ife6na-2"})(["position:absolute;"]),Pe=(e,t,i,n,r,o)=>(0,G.jsx)(a.Fragment,{children:(0,G.jsx)(ie,{as:Ie,dataTestId:"flexitome_tile_file_dropzone",indicatorTargetId:t,onDrop:i,style:r,children:(0,G.jsx)(me,{indicatorId:t,radius:o})})},e);var xe=e=>{let{children:t,tileIds:i,tileIdsSupportingTileDropzone:n,rowCanHoldMoreTiles:r,tomeId:o,pageId:l,rowId:d,rowIdx:c,enabled:u,dropHandler:p,onTileDropHandler:g,disabledDropzones:h,dropzoneContainerStyle:f,debugMode:m,pageWidth:y,pagePadding:v,tileRadius:w}=e;const b=(0,s.sJ)(F.GS),I=(0,s.sJ)(F.sA),P=I&&i.includes(I),{getMainController:x}=(0,a.useContext)(Q.Z),T=x(l),O=[],R=[];for(let a=0;a<=i.length;a++){h.includes(a);const e=0===a;let t;const s=a===i.length;t=r||!s||P?{tomeId:o,pageId:l,kind:"vertical",rowId:d,tileIdx:a}:{tomeId:o,pageId:l,kind:"horizontal",rowIdx:c+1};const u=i[a]??i[a-1],b=T.getTilePosition(u,y,v),I=ve(ve(ve({},f),m?{backgroundColor:"rgba(0, 0, 0, 0.2)",border:"1px solid lime"}:{}),{},{width:b.width/2+1.5*X.j,left:b.left+b.width/2-v});if(e&&(I.left=1.5*-X.j),!e&&!s){const e=T.getTilePosition(i[a-1],y,v);I.left=e.left+e.width/2-v,I.width=e.width/2+b.width/2+v}if(s&&(I.left=b.left+b.width/2-v),O.push((C=a,j=t,E=p({kind:ee.r.EXISTING_ROW,rowId:d,newTileIdx:a}),S=I,(0,G.jsx)(ie,{as:Ie,dataTestId:"flexitome_tile_dropzone",indicatorTargetId:j,onDrop:E,style:S},C))),s)break;const x=ve(ve({},m?{backgroundColor:"rgba(255, 255, 0, 0.2)",border:"1px solid yellow"}:{}),{},{height:"100%",width:b.width,left:b.left-v,position:"absolute"}),D={tomeId:o,pageId:l,kind:"tile",tileId:u};n.has(u)&&R.push(Pe(`tile_${u}`,D,g(u),0,x,w))}var C,j,E,S;const D=(0,se.Z)();return(0,G.jsxs)(we,{$dragInProgress:!!D||m,children:[t,u&&(D||m)&&(0,G.jsx)(be,{style:{height:"100%",top:0},children:O.concat(b?R:[])})]})};const Te=l.ZP.div.withConfig({displayName:"VerticalIndicator__Container",componentId:"sc-1k3clls-0"})(["width:100%;height:100%;"]);var Oe=e=>{let{debugMode:t,indicatorId:i}=e;const n=(0,se.Z)();return t||n?(0,G.jsx)(Te,{children:(0,G.jsx)(ae,{indicatorId:i,dataTestId:"flexitome_tile_dropzone_indicator",orientation:"vertical"})}):null};const Re=l.ZP.div.withConfig({displayName:"VerticalTileGutter__Container",componentId:"e9424p-0"})(["position:absolute;height:100%;",""],(e=>e.$debugMode&&"background-color: rgba(0, 0, 255, 0.4);"));var Ce=e=>{let{children:t,debugMode:i,style:n}=e;return(0,G.jsx)(Re,{$debugMode:i,style:n,children:t})},je=i(71515),Ee=i(40312),Se=i(39626);var De=e=>{let{onResizeStart:t,onResize:i,onResizeComplete:n,pagePadding:r,rowIndex:o,tileIndex:l,tilePosition:c,pageWidth:u}=e;const p=c.left-1.5*r,{0:g,1:h}=(0,a.useState)(!1),{0:f,1:m}=(0,a.useState)(!1),y=(0,se.Z)(),v=(0,s.sJ)(F.lk),[w,b]=(0,s.FV)(F.MJ),I=!y&&!v&&(!w||g),P=(0,a.useRef)(0),x=(0,a.useRef)(i);x.current=i;const T=(0,a.useRef)(n);T.current=n;const O=(0,a.useCallback)((e=>{const t=e.pageX-P.current,i=x.current(t);m(i===Se.yV.REACHED_MINIMUM)}),[]),R=(0,a.useCallback)((()=>{h(!1),b(!1),m(!1),window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",R),T.current()}),[O,b]),C=(0,a.useCallback)((e=>{h(!0),b(!0),t(e.altKey),P.current=e.pageX,window.addEventListener("mousemove",O),window.addEventListener("mouseup",R)}),[O,R,t,b]),j=c.left<u/2?"right":"left",E=f?$.ALERT:$.ACTIVE,S=f?$.ALERT_HIDE:$.HIDE,{t:D}=(0,d.$G)();return(0,G.jsxs)(V,{"data-testid":"tile_resize_handle","data-testid-resize-position":`${o}-${l}`,$variant:"vertical",style:{top:c.top,height:c.height,left:p,width:2*r,pointerEvents:I?"auto":"none"},variants:W,initial:$.HIDE,whileHover:g?E:$.SHOW,animate:g?E:S,onMouseDown:C,children:[(0,G.jsx)(je.Z,{content:D("pageLayout.resizeHandles.tileWidthResizeHandle.resizeAdjacentHandle"),shortcuts:[(0,Ee.C6)(),"\u2194"],placement:j,tooltipDisabled:!I,delay:500,offset:8,children:(0,G.jsx)(J,{pagePadding:r,enabled:I,"data-testid":"tooltip_target",children:(0,G.jsx)(B,{$variant:"vertical",$pagePadding:r,$alert:g&&f})})}),g&&(0,G.jsx)(z,{})]})};var _e=e=>{let{pageId:t,rowId:i,rowIndex:n,sizes:r,tileId:o,tileIndex:s}=e;const{pageSizes:l}=r,{getMainController:d}=(0,a.useContext)(Q.Z),c=d(t),u=c.getTilePosition(o,l.width,l.padding),{handleResizeStart:p,handleResize:g,handleResizeComplete:h}=(0,a.useMemo)((()=>c.getTileResizeHandlers(s,i,l.width)),[c,s,i,l.width]);return(0,G.jsx)(De,{rowIndex:n,tileIndex:s,onResizeStart:p,onResize:g,onResizeComplete:h,tilePosition:u,pagePadding:l.padding,pageWidth:l.width},o)};function ke(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}const Ae=l.ZP.div.withConfig({displayName:"RowInteractivity__TilesOverlayContainer",componentId:"sc-2r5wwz-0"})(["width:100%;",""],(e=>e.$debugMode&&"background-color: rgba(0, 255, 0, 0.4);"));var Ze=e=>{let{page:t,sizes:i,row:o,rowIdx:l,tomeId:c,rowHeightInUnits:u,isFirstRow:p,isLastRow:m,stackedPageRef:y,debugMode:v=!1}=e;const{t:w}=(0,d.$G)(),{pageSizes:b,rowSizes:I}=i,P=(0,r.l)(f.oG),x=(0,s.sJ)(g.Hl),T=(0,s.sJ)(L.zh),O=(0,s.Zl)((0,_.$)(c)),{apolloClient:R,clientId:z}=(0,h.bp)(),[N,U]=(0,s.FV)(F.sA),{getMainController:$}=(0,a.useContext)(Q.Z),W=$(t.id),V=(0,k.t2)(),B=(0,a.useCallback)((function(e,i){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e.length)return null;const r=(0,M.ln)(c,t.id,W,e,R,z,i);return(0,f.Dm)(r[0]),n&&V.setPropertyPanel(A.Z.TILE),r}),[R,z,t.id,W,V,c]),{onInsertFiles:J}=(0,j.Z)({addTilesInPage:B}),K=(0,s._8)((e=>{let{set:t}=e;return(e,i)=>{(null===i||void 0===i?void 0:i.type)===H.YUT.Image&&!i.contentLink&&e.type.startsWith("image/")&&t((0,Z.vw)(i.id),(0,Z.aY)(e)),(null===i||void 0===i?void 0:i.type)===H.YUT.Video&&!i.contentLink&&e.type.startsWith("video/")&&t((0,Z.vw)(i.id),(0,Z.aY)(e))}}),[]),te=(0,D.Z)(((e,i)=>{let{e:n}=i;if((0,S.X)(n)&&(0,S.C)(n)&&n.dataTransfer.files.length>0){var r;const i=n.dataTransfer.files[0],o=null===(r=t.tiles)||void 0===r?void 0:r.find((t=>t.id===e));o&&K(i,o)}}),[K,t.tiles]),ie=(0,D.Z)(((e,i)=>{let{e:r,dndData:a}=i;if((0,S.X)(r)&&(0,S.C)(r)){const t=r.dataTransfer.files,i=[];for(let e=0;e<t.length&&e<16;e++)i.push(t[e]);C.v.addAction("Drag to add media",{files:i.map((e=>({name:e.name,type:e.type})))});const n=J(i,e);n.length>0&&(O({title:w("pageLayout.unsupportedMediaAlert.title"),subtitle:w("pageLayout.unsupportedMediaAlert.subtitle")}),C.v.addAction("Unsupported media format after dragging",{file:n.map((e=>({name:e.name,type:e.type})))}))}else if(a)switch(a.kind){case E.A.ADD_TILE:{const t={type:a.typeType};B([t],e)}break;case E.A.MOVE_TILE:{var s;if(U(null),!T){W.moveTile(a.tileId,e);break}const i=null===(s=t.tiles)||void 0===s?void 0:s.find((e=>e.id===a.tileId));if(i){const t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ke(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},i);delete t.id;const r={kind:ee.r.EXISTING_ROW,rowId:o.id,newTileIdx:o.tileIndex(i.id)??0};B([t],r,!1),W.moveTile(a.tileId,e),requestAnimationFrame((()=>{(0,f.Dm)(i.id)}))}break}}}),[J,O,w,B,U,T,t.tiles,W,o]),{handleResizeStart:ne,handleResize:re,handleResizeComplete:oe}=(0,a.useMemo)((()=>W.getRowResizeHandlers(o.id)),[W,o.id]),ae=e=>({tomeId:c,pageId:t.id,kind:"horizontal",rowIdx:e}),se=e=>({tomeId:c,pageId:t.id,kind:"vertical",rowId:o.id,tileIdx:e}),le=(0,a.useMemo)((()=>W.findNoopDropzones(N)),[N,W]),de=(0,a.useCallback)((e=>le.horizontal.includes(e)),[le.horizontal]),ce=(0,a.useCallback)((()=>{const e=le.vertical.find((e=>e.rowIdx===l));return e?e.indices:[]}),[le.vertical,l]),ue=I.unitRowHeight*u,ge=ue-b.padding,he=ue*X.p3,fe=(0,a.useMemo)((()=>{var e;return new Set((null===(e=t.tiles)||void 0===e?void 0:e.filter((e=>!e.contentLink&&(e.type===H.YUT.Image||e.type===H.YUT.Video))).map((e=>e.id)))??[])}),[t.tiles]);return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(pe,{enabled:!P&&!de(l),indicatorId:ae(l),onDrop:ie({kind:ee.r.NEW_ROW,newRowIdx:l}),displayIndicator:p,indicatorStyle:{top:p?0:b.padding/2-X.cn/2},dropzoneStyle:{top:p?-X.tS-b.padding/2:-b.padding/2,height:p?X.tS+he:he,width:b.width+2*X.j},debugMode:v}),(0,G.jsx)(xe,{tileIds:o.tiles.map((e=>e.tileId)),tileIdsSupportingTileDropzone:fe,rowCanHoldMoreTiles:o.canAddMoreTiles(),tomeId:c,pageId:t.id,rowId:o.id,rowIdx:l,enabled:!P,dropHandler:ie,onTileDropHandler:te,disabledDropzones:ce(),dropzoneContainerStyle:{top:he-b.padding/2,height:3*he},debugMode:v,pageWidth:b.width,pagePadding:b.padding,tileRadius:i.tileSizes.radius,children:(0,G.jsx)(Ae,{$padding:b.padding,$debugMode:v,"data-testid":"page_row",style:{height:`${ge}px`},children:o.tiles.map(((e,t)=>{const{tileId:i}=e,n=W.getTilePosition(i,b.width,b.padding),r=n.left+n.width-b.padding/2-X.cn/2,s=n.left+n.width-b.padding;return(0,G.jsxs)(a.Fragment,{children:[0===t&&(0,G.jsx)(Ce,{debugMode:v,style:{left:-X.cn},children:(0,G.jsx)(Oe,{debugMode:v,indicatorId:se(0)})}),(0,G.jsx)(Ce,{debugMode:v,style:{left:t<o.tiles.length-1?r:s},children:(0,G.jsx)(Oe,{debugMode:v,indicatorId:se(t+1)})})]},i)}))})}),o.tiles.map(((e,n)=>0===n?null:(0,G.jsx)(_e,{pageId:t.id,tileIndex:n,rowIndex:l,rowId:o.id,sizes:i,tileId:e.tileId},e.tileId))),(0,G.jsx)(pe,{indicatorId:ae(l+1),onDrop:ie({kind:ee.r.NEW_ROW,newRowIdx:l+1}),enabled:!de(l+1),indicatorStyle:{top:b.padding/2-X.cn/2},dropzoneStyle:{bottom:m?-X.tS-b.padding/2:-b.padding/2,height:m?X.tS+he:he,width:b.width+2*X.j},displayIndicator:!0,debugMode:v}),(0,G.jsx)(q,{style:{height:b.padding},children:(0,G.jsx)(Y,{onResizeStart:ne,onResize:re,onResizeComplete:oe,enabled:!x&&!P,pagePadding:b.padding,stackedPageRef:y})})]})},Le=i(76166),He=i(85769),Me=i(33340);const ze=l.ZP.div.withConfig({displayName:"TileSelectionWrapper__Highlight",componentId:"sc-1ot5lz9-0"})(["position:absolute;top:0;left:0;right:0;bottom:0;border-radius:","px;pointer-events:none;opacity:",";transition:opacity 0.2s ease;background-color:",";"],(e=>e.$radius),(e=>{let{$highlight:t}=e;return t?1:0}),(e=>{let{theme:t,tileType:i}=e;return i===H.YUT.Table?t.colors.tileHoverTable:t.colors.tileHover})),Ne=l.ZP.div.withConfig({displayName:"TileSelectionWrapper__Selection",componentId:"sc-1ot5lz9-1"})(["position:absolute;top:0;left:0;right:0;bottom:0;border-radius:","px;pointer-events:none;box-shadow:",";opacity:",";"],(e=>e.$radius),(e=>`0px 0px 0px 2px ${e.$isSecondary?e.theme.colors.tileSecondarySelection:e.theme.colors.tilePrimarySelection}`),(e=>e.$selected&&!e.$disabled?1:0)),Ue=l.ZP.div.withConfig({displayName:"TileSelectionWrapper__TileWrapper",componentId:"sc-1ot5lz9-2"})(["height:100%;width:100%;position:relative;display:flex;flex:1;top:0;overflow:visible;border-radius:","px;&:hover ","{",";}"],(e=>e.$radius),ze,(e=>e.$hoverDisabled?"":"\n            opacity: 1;\n          "));var $e=e=>{let{children:t,id:i,radius:n,preview:o,canEdit:a,tileType:l}=e;const d=(0,s.sJ)(c.cm),u=(0,s.sJ)(c.s5),p=(0,s.sJ)(g.Hl),h=(0,r.l)(f.oG),m=(0,s.sJ)(f.DH),y=(0,s.sJ)(He.SI),v=(0,s.sJ)((0,Me.pt)(i)),w=(0,r.l)(f.Dm),b=(0,r.l)(f.bT),I=(0,s.sJ)(F.sA),P=(0,s.sJ)(F.MJ),x=(0,s.sJ)(F.lk),T=(0,s.sJ)(F.GS),O=w===i,R=Boolean(d||u||m||h||I||x||P),C=null!==y||v,j=o||!a,E=P||x||b||I||T;return(0,G.jsxs)(Ue,{$radius:n,$hoverDisabled:O||R||p||j,children:[!j&&(0,G.jsx)(ze,{$highlight:!!E,$radius:n,tileType:l}),!j&&(0,G.jsx)(Ne,{"data-testid":"tile_selection",$selected:O,$disabled:R,$isSecondary:C,$radius:n}),t]})},We=i(60153),Fe=i(12464),Ve=i(2372),Be=i(70974);var Je=l.vJ`
// A powerful override that is only present when dragging to copy
body, body * {
  cursor: copy !important;
  user-select: none !important;
}
`;function Ge(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Ye(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ge(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const Ke="tile-last-dragged-item",qe=(0,l.ZP)(o.E.div).withConfig({displayName:"TilePositioner__AnimatedWrapper",componentId:"sc-3tpuzl-0"})(["position:absolute;&.","{pointer-events:none !important;z-index:1 !important;}"],Ke),Xe={type:"spring",stiffness:110,damping:20,mass:1};var Qe=e=>{let{children:t,position:i,tileId:n,preview:r,enableDrag:o,pageVerticalMargin:d,setTileIsAnimating:c,animatingBorderRadius:u,style:p}=e;const g=(0,We.o)(),h=(0,a.useRef)(null),{scrollContainerIfNeeded:m,cancelAnyScrolling:y}=(0,U.Z)(),{0:v,1:w}=(0,a.useState)(!1),{0:b,1:I}=(0,a.useState)({x:0,y:0}),{0:P,1:x}=(0,a.useState)(),T=(0,s.sJ)(L.zh),{scrollingPageRef:O}=(0,a.useContext)(N.Z),R=(0,l.Fg)(),C=(0,a.useMemo)((()=>{const e=Ye({},i);for(const t of Object.keys(e))Number.isNaN(e[t])&&delete e[t];return e}),[i]),j=(0,s.Zl)(F.sA),S=(0,s.Zl)(F.LY),D=(0,a.useMemo)((()=>({kind:E.A.MOVE_TILE,tileId:n})),[n]),_=(0,a.useCallback)((e=>{const t=e.target,i=document.activeElement,n=null!==t.closest("[data-disable-drag]"),r=null!==t.closest("[data-slate-editor]"),o=(null===i||void 0===i?void 0:i.isContentEditable)||"TEXTAREA"===(null===i||void 0===i?void 0:i.tagName);(n||r||e.currentTarget.contains(document.activeElement)&&o)&&g.componentControls.forEach((t=>{t.stop(e)}))}),[g]),k=(0,a.useCallback)((e=>{m(e)}),[m]),A=(0,a.useCallback)((e=>{if(h.current){var t;const i=h.current.getBoundingClientRect();I({x:e.pageX-i.x,y:e.pageY-i.y});const n=null===(t=h.current.offsetParent)||void 0===t?void 0:t.getBoundingClientRect();null!==n&&void 0!==n&&n.x&&null!==n&&void 0!==n&&n.y&&x({x:null===n||void 0===n?void 0:n.x,y:null===n||void 0===n?void 0:n.y})}w(!0),j(n),S(D)}),[j,S,D,n]),Z=(0,a.useRef)(!1),H=(0,a.useCallback)((()=>{var e;y(),I({x:0,y:0}),w(!1),j(null),Z.current=!0,c(n,!0),null===(e=h.current)||void 0===e||e.classList.add(Ke)}),[y,h,j,c,n]),M=(0,a.useRef)(!1),z=(0,a.useCallback)((()=>{if(!Z.current&&!M.current){0===c(n,!1)&&document.querySelectorAll(".tile-last-dragged-item").forEach((e=>{e.classList.remove(Ke)}))}}),[c,n]),$=(0,a.useCallback)((e=>{"rest"!==e||r||(c(n,!0),M.current=!0)}),[r,c,n]),W=(0,a.useCallback)((e=>{"rest"!==e||r||(M.current=!1,z())}),[z,r]),V=(0,a.useCallback)((()=>{Z.current=!1,z()}),[z]),B=(0,a.useMemo)((()=>(0,Fe.oD)()),[]),[J,Y]=(0,s.FV)((0,f.Eq)(n)),K=(0,a.useCallback)((()=>{if(O.current){const e=O.current,t=e.scrollTop+e.clientHeight-R.headerHeight-d,i=C.top+C.height;i>=t?e.scrollTop+=i-t:C.top<e.scrollTop&&(e.scrollTop=C.top)}}),[C.height,C.top,d,O,R.headerHeight]);(0,a.useEffect)((()=>{!r&&J&&(K(),Y(!1))}),[r,K,J,Y]);const q={backgroundColor:v?R.colors.tilePositionWhileDragBackground:"unset",boxShadow:v?R.colors.tilePositionAnimatingShadow:"unset",transformOrigin:`${null===b||void 0===b?void 0:b.x}px ${null===b||void 0===b?void 0:b.y}px`,pointerEvents:"auto"};if(!B)return(0,G.jsx)("div",{children:(0,G.jsx)(qe,{initial:C,style:q,children:t})});const X=v&&T;return(0,G.jsxs)("div",{suppressHydrationWarning:!0,children:[(0,G.jsxs)(Fe.Nq,{node:B,children:[X&&(0,G.jsx)(qe,{initial:C,style:p,children:t}),(0,G.jsx)(qe,{ref:h,variants:{rest:Ye(Ye({},C),{},{transition:{duration:0}}),active:Ye(Ye({borderRadius:u},C),{},{transition:r?{duration:0}:Ye(Ye({},Xe),{},{duration:.3})})},initial:"rest",animate:v&&!r?"active":"rest",drag:o,dragControls:g,dragSnapToOrigin:!0,onPointerDown:_,onDragStart:A,onDrag:k,onDragEnd:H,onAnimationStart:$,onAnimationComplete:W,onDragTransitionEnd:V,style:Ye(Ye({},q),p),whileDrag:{opacity:.5,scale:.75,zIndex:te.C8,pointerEvents:"none"},children:t})]}),v?(0,G.jsx)(Be.Z,{scaleToPage:!0,dragPosition:P,node:B}):(0,G.jsx)(Fe.t0,{node:B}),v&&!X&&(0,G.jsx)(Ve.Z,{}),X&&(0,G.jsx)(Je,{})]})};const et=(0,a.forwardRef)(((e,t)=>{let{tile:i,enableDrag:n,position:r,preview:o,row:a,tomeId:s,sizes:l,activeDragInProgress:d,page:c,onTileResize:u,rowHeightinPx:p,rowIndex:g,tileIndex:h,isFirstPage:f,active:m,canEdit:y,pageVerticalMargin:v,setTileIsAnimating:w,pageKind:b,style:I}=e;const{tileSizes:P}=l;return(0,G.jsx)(Qe,{position:r,tileId:i.id,preview:o,enableDrag:n,pageVerticalMargin:v,setTileIsAnimating:w,animatingBorderRadius:l.tileSizes.radius,style:I,children:(0,G.jsx)($e,{id:i.id,radius:P.radius,preview:o,canEdit:y,tileType:i.type,children:(0,G.jsx)(Le.n,{ref:t,canEdit:y,isMobile:!1,isSingle:a.isSingleTile(),preview:o,tile:i,tomeId:s,sizes:l,page:c,activeDragInProgress:d,index:h,isFirstPage:f,isPageActive:m,isTileEndpoint:!1,disableAnnotations:!1,disableExpand:!1,onTileResize:u,rowHeight:p,rowIndex:g,rowId:a.id,tileIndex:h,pageKind:b})},`${i.id}-selection-wrapper`)})}));var tt=et,it=i(71652),nt=i(21585);function rt(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function ot(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rt(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const at=l.ZP.div.withConfig({displayName:"Page__StackedPage",componentId:"sc-1omh4nr-0"})(["position:relative;display:flex;justify-content:center;"]),st=(0,l.ZP)(o.E.div).withConfig({displayName:"Page__PageStyles",componentId:"sc-1omh4nr-1"})(["height:100%;position:relative;justify-content:start;align-items:center;@media ","{display:flex;flex-direction:column;}visibility:",";"],m.Hb.mobile,(e=>e.$preview||e.$isVisible?"visible":"hidden")),lt=l.ZP.div.withConfig({displayName:"Page__PageSelectionRing",componentId:"sc-1omh4nr-2"})([""]),dt=l.ZP.div.withConfig({displayName:"Page__PagePreviewWrapper",componentId:"sc-1omh4nr-3"})([""]),ct=(e,t)=>{var i;let{page:n,preview:o,active:m,isBot:v=!1,isVisible:C,canEdit:j,useEditablePage:E,tomeId:S,sizes:D,isFirstPage:_,pageVerticalMargin:k,pageKind:A,debugMode:Z=!1,skipReportPresence:L=!1}=e;const{t:H}=(0,d.$G)(),{apolloClient:M,clientId:z}=(0,h.bp)(),N=(0,s.sJ)(c.cm),U=(0,s.sJ)(c.s5),$=(0,r.l)(f.oG),W=(0,s.sJ)(f.DH),V=(0,r.l)(f.Dm),B=(0,s.sJ)(F.GS),J=(0,s.sJ)(g.Hl),Y=(0,s.sJ)(g.tF),K=(0,s.sJ)((0,b.J)(S)),q=(0,l.Fg)(),X=(0,a.useRef)(null),{pageSizes:Q,rowSizes:ee}=D,te=(0,I.Z)(Q.height),ie=(0,a.useCallback)((()=>{p.z.reportViewPresence(M,z,S,n.id)}),[M,z,S,n.id]);(0,a.useEffect)((()=>{L||!o&&m&&ie()}),[m,o,ie,L]);const ne=(0,T.Z)(n.tiles);(0,a.useEffect)((()=>{var e;if(!m||o)return;const t=null===ne||void 0===ne?void 0:ne.some((e=>e.id===V)),i=null===(e=n.tiles)||void 0===e?void 0:e.some((e=>e.id===V));t&&!i&&(0,f.Dm)(null)}),[null===(i=n.tiles)||void 0===i?void 0:i.length]);const re=$&&!o&&m,oe=$&&!o,{getComputedColors:ae}=w();(0,P.L)(n.theme),(0,a.useEffect)((()=>{if(!m)return;let e=q.colors.background;re&&(e=q.colors.page);const[t]=ae(X,[e]);t&&(0,y.A)(t)}),[m,ae,re,q.colors.background,q.colors.page]);const se=[{type:"option",text:H("hooks.tile.menu.paste"),action:()=>{window.postMessage({type:x.SG,dataTransferType:x.T0.TILE},"*")}}],le=((0,r.l)(f.bT)||B)&&m,de=(0,R.Z)({tomeId:S,pageId:n.id,pageKind:A,layout:n.layout,tiles:n.tiles,pixelsPerHeightUnit:ee.unitRowHeight,rowPadding:Q.padding,persistToBackend:!o}),ce=de.frontendPageLayout,ue=(0,a.useMemo)((()=>de.triggerLayoutRecalculationAndRender.bind(de)),[de]);(0,a.useEffect)((()=>{o&&ue()}),[o,ue]);const pe=(0,a.useRef)(new Set),ge=(0,a.useCallback)(((e,t)=>(t?pe.current.add(e):pe.current.delete(e),pe.current.size)),[pe]),he=D.calculatePageHeight(de.sumOfRowHeightsInUnits()),fe=(0,G.jsxs)(G.Fragment,{children:[ce.allTileIds.map((e=>{var t;const i=null===(t=n.tiles)||void 0===t?void 0:t.find((t=>t.id===e));if(!i)return null;const r=ce.rowByTileId(e);if(!r)return null;const a=de.getTilePosition(e,Q.width,Q.padding),s=!o&&m&&j&&!$&&!W&&!J&&!N&&!U,l=de.getTileHeightInPx(r.id);return(0,G.jsx)(tt,{ref:de.tileRefCallback(e),tile:i,preview:o,position:a,enableDrag:s,row:r,tomeId:S,sizes:D,page:n,activeDragInProgress:le,onTileResize:ue,rowHeightinPx:l,rowIndex:ce.rowIndex(r.id),tileIndex:r.tileIndex(e),isFirstPage:_,active:m,canEdit:j,pageVerticalMargin:k,setTileIsAnimating:ge,pageKind:A},i.id)})),m&&!o&&j&&E&&ce.rows.map(((e,t)=>(0,G.jsx)(Ze,{page:n,sizes:D,row:e,rowIdx:t,tomeId:S,rowHeightInUnits:de.getRowHeight(e.id),isFirstRow:0===t,isLastRow:t===ce.rows.length-1,debugMode:Z,stackedPageRef:X},e.id)))]}),me=(0,G.jsx)(G.Fragment,{children:ce.rows.map((e=>e.tiles.map((t=>{var i;const r=null===(i=n.tiles)||void 0===i?void 0:i.find((e=>e.id===t.tileId));if(!r)return null;const{tileId:a}=t,s=de.getTileHeightInPx(e.id),l=de.getTilePosition(a,Q.width,Q.padding),d=!o&&m&&j&&!$&&!W&&!J&&!N&&!U;return(0,G.jsx)(tt,{style:oe?{transition:"opacity 0.5s cubic-bezier(0.33, 1, 0.68, 1)",opacity:v||te?1:0}:{},ref:de.tileRefCallback(a),tile:r,preview:o,position:l,enableDrag:d,row:e,tomeId:S,sizes:D,page:n,activeDragInProgress:le,onTileResize:ue,rowHeightinPx:s,rowIndex:ce.rowIndex(e.id),tileIndex:e.tileIndex(a),isFirstPage:_,active:m,canEdit:j,pageVerticalMargin:k,setTileIsAnimating:ge,pageKind:A},r.id)}))))}),ye=()=>(0,G.jsx)(st,ot(ot({ref:t},m?{"data-testid":"active_page",id:"active_page"}:{}),{},{$isVisible:C,$preview:o,style:{height:`${he}px`,minHeight:Q.height,width:Q.width,borderRadius:o?0:Q.radius,padding:`${Q.padding}px ${Q.padding}px 0`,backgroundColor:o||!W||$?q.colors.page:q.colors.background},children:E?fe:me}));return(0,G.jsx)(nt.Z,{menuWidth:180,menuPosition:"below",menuAlign:"click",rightClickActivated:!0,itemsOrFn:se,disabled:!j||$||o,triggerRef:null,children:(0,G.jsxs)(at,{ref:X,children:[!o&&m&&!K&&(0,G.jsx)(O.Z,{overlayData:n.overlay,pageId:n.id,canEdit:j,tomeId:S,display:Y,pageHeight:he,pageWidth:Q.width,isMobile:!1,playMode:$&&A!==u.s.PAGE_ENDPOINT}),o?(0,G.jsx)(lt,{"data-testid":"outline_selection_ring",children:(0,G.jsx)(dt,{children:(0,G.jsx)(it.Z,{theme:n.theme,children:ye()})})}):(0,G.jsx)(G.Fragment,{children:ye()})]})})};var ut=(0,a.memo)((0,a.forwardRef)(ct))},83887:function(e,t,i){i.d(t,{Z:function(){return ce}});var n=i(67294),r=i(4480),o=i(46513),a=i(4960),s=i(1922),l=i(77774),d=i(77717),c=i(53098),u=i(51718),p=i(24418),g=i(21585),h=i(17463),f=i(8595),m=i(90170),y=i(4034),v=i(2372),w=i(41100),b=i(59499),I=i(62830),P=i.n(I),x=i(59016),T=i(64310),O=i(36828),R=i(48264),C=i(84827),j=i(60864),E=i(89202),S=i(22124),D=i(35464),_=i(40461);function k(e,t,i,n){const r=Math.min(e,t);let o=0,a=0;return e>r&&(o=(e-r)/2),t>r&&(a=(t-r)/2),[o,a,r,r,0,0,i,n]}var A=i(85893);function Z(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function L(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(i),!0).forEach((function(t){(0,b.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Z(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const H=x.ZP.div.withConfig({displayName:"PreviewOverlay__Placeholder",componentId:"sc-1v9gcwf-0"})(["position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:100%;min-width:100%;width:100%;height:100%;object-fit:cover;background-color:",";border-radius:100px;"],(e=>e.theme.colors.overlayPlaceholderBg)),M=x.ZP.img.withConfig({displayName:"PreviewOverlay__Image",componentId:"sc-1v9gcwf-1"})(["position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:100%;min-width:100%;width:100%;height:100%;object-fit:cover;background-color:",";border-radius:100px;",";"],(e=>e.theme.colors.page),(e=>{let{$isFlipped:t}=e;return t&&(0,x.iv)(["transform:translate(-50%,-50%) scaleX(-1);"])})),z=x.ZP.canvas.withConfig({displayName:"PreviewOverlay__HiddenCanvas",componentId:"sc-1v9gcwf-2"})(["display:none;"]),N=x.ZP.video.withConfig({displayName:"PreviewOverlay__HiddenVideo",componentId:"sc-1v9gcwf-3"})(["display:none;"]);var U=e=>{let{enableVideo:t,enableRecording:i,tomeId:o,pageId:a,setCanPlay:d,setScaledUp:c,checkForMediaDevices:u}=e;const{t:g}=(0,s.$G)(),f=(0,R.Z)({tomeId:o}),{apolloClient:m,clientId:y}=(0,p.bp)(),v=(0,n.useRef)(null),w=(0,n.useRef)(null),b=(0,n.useRef)(0),[I,x]=(0,r.FV)((0,h.vw)(a)),Z=(0,r.rb)((0,h.vw)(a)),U=(0,n.useCallback)((e=>{(0,l.XL)(o,a,e,m,y)}),[o,a,m,y]),$=(0,n.useCallback)((e=>{x((t=>L(L({},t),{},{progress:e})))}),[x]),W=(0,n.useCallback)((()=>{(0,l.Yt)(o,a,m,y)}),[o,a,m,y]),F=(0,n.useCallback)((()=>{(0,l.o1)(o,a,m,y),Z(),(0,j.ak)({message:g("overlay.genericError")}),T.v.addError(new Error("Failed to upload overlay"),{tomeId:o,pageId:a})}),[o,a,m,y,Z,g]),V=(0,n.useCallback)(((e,t)=>{const i=P()(),n=new File([e],i);x((e=>L(L({},e),{},{inProgress:!0}))),f(n,n.name,"",t,void 0,a,$,W,F,U)}),[x,f,a,$,W,F,U]),B=(0,n.useCallback)(((e,t)=>{const i=P()();x({uploadId:i,inProgress:!1,progress:0,localMediaUrl:e}),window.safari?t.arrayBuffer().then((e=>{const t=[{name:"inputVideo.mp4",data:e}],n=new Worker("/ffmpeg-worker-mp4.js",{name:"ffmpegjs"});n.onmessage=r=>{const o=r.data;switch(o.type){case"ready":n.postMessage({type:"run",MEMFS:t,arguments:["-i","inputVideo.mp4","-codec","copy","-bsf:v","h264_mp4toannexb","outputStream.mp4"]},[e]);break;case"stdout":case"stderr":console.log(o.data);break;case"done":{const e=o.data.MEMFS[0];if(e.data&&(e.data=e.data.buffer,"outputStream.mp4"===e.name&&n.postMessage({type:"run",MEMFS:o.data.MEMFS,arguments:["-r","30","-i","outputStream.mp4","-c","copy","outputVideo.mp4"]},[e.data]),"outputVideo.mp4"===e.name)){const t=new Blob([e.data]);V(t,i)}break}}}})):V(t,i)}),[x,V]),{startRecording:J,stopRecording:G,turnVideoOn:Y,turnVideoOff:K,previewStream:q,exportStream:X,checkPermissionsAndUpdateMediaDevices:Q}=(0,O.L)({onStop:B}),ee=(0,r.sJ)(_.fT),te=(0,n.useRef)(null),{0:ie,1:ne}=(0,n.useState)(null),{0:re,1:oe}=(0,n.useState)(!1),{localMediaUrl:ae}=I,se=(0,n.useRef)(!1),le=w.current,de=null===le||void 0===le?void 0:le.getContext("2d"),ce=(0,n.useCallback)((()=>{if(b.current=requestAnimationFrame(ce),q&&v.current&&le&&de){const{videoWidth:t,videoHeight:i}=v.current,{width:n,height:r}=le;de.clearRect(0,0,n,r);try{null===de||void 0===de||de.drawImage(v.current,...k(t,i,n,r))}catch(e){T.v.addError(e,{videoWidth:t,videoHeight:i,width:n,height:r,centeredDrawImageParameters:k(t,i,n,r)})}}}),[le,de,q]);(0,n.useEffect)((()=>{if(w.current&&v.current&&te.current&&q&&le){var e;const t=null===(e=q.getVideoTracks())||void 0===e?void 0:e[0];let i;if(t){const e=t.getSettings(),{width:n,height:r}=e,o=Math.min(n??1/0,r??1/0);le.width=o,le.height=o,e.frameRate&&(i=e.frameRate)}const n=le.captureStream(i);n.addTrack(q.getAudioTracks()[0]),te.current.srcObject=n,X&&q&&(X.current=n),v.current.srcObject=q,v.current.play()}}),[le,X,q]),(0,n.useEffect)((()=>(q&&(b.current=requestAnimationFrame(ce)),()=>{cancelAnimationFrame(b.current)})),[ce,q]),(0,n.useEffect)((()=>{te.current&&!q&&(te.current.srcObject=q)}),[q]),(0,n.useEffect)((()=>{u&&!se.current&&(Q(),se.current=!0)}),[u,Q]),(0,n.useEffect)((()=>(t&&Y(),t||(K(),oe(!1)),()=>{K(),oe(!1)})),[t,Y,K]);const ue=(0,E.Z)(i);(0,n.useEffect)((()=>{i!==ue&&(i&&te.current?(ne(null),Y().then((()=>{J().then((()=>{te.current&&(0,C.b)(te.current).then((e=>{e&&ne(URL.createObjectURL(e))}))}))}))):"recording"===ee&&(G(),K(),oe(!1)))}),[i,ee,G,K,Y,J,ue]),(0,n.useEffect)((()=>{d(!1),oe(!1),ae||ne(null)}),[d,ae]);const pe=(0,n.useCallback)((()=>{d(!0),oe(!0)}),[d]),ge=(0,r._8)((e=>{let{snapshot:t,reset:i}=e;return()=>{const{inProgress:e,uploadId:n,progress:r}=t.getLoadable((0,h.vw)(a)).getValue();e&&T.v.addAction("Unmount while uploading overlay",{uploadVideo:{pageId:a,uploadId:n,progress:r}}),i((0,h.vw)(a))}}),[a]);return(0,n.useEffect)((()=>ge),[ge]),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(S.U,{animate:{scale:"recording"===ee&&re?D.p3:1},onAnimationComplete:e=>{e.scale===D.p3?c(!0):c(!1)},children:[t&&(0,A.jsx)(H,{}),ie&&(0,A.jsx)(M,{$isFlipped:!0,src:ie}),(0,A.jsx)(S.Y,{$isFlipped:!0,muted:!0,ref:te,width:500,height:500,autoPlay:!0,onCanPlay:pe,$visible:re})]}),(0,A.jsx)(z,{ref:w}),(0,A.jsx)(N,{muted:!0,playsInline:!0,ref:v})]})};const $=x.ZP.div.withConfig({displayName:"Countdown__CountdownWrapper",componentId:"sp2jf-0"})(["height:294px;width:294px;border-radius:100%;background-color:",";position:absolute;margin-left:auto;z-index:",";left:calc(50% - 147px);top:calc(50% - 147px);font-size:126px;font-weight:100;color:",";text-align:center;vertical-align:middle;line-height:294px;box-shadow:0px 100px 80px rgba(0,0,0,0.07),0px 41.7776px 33.4221px rgba(0,0,0,0.0503198),0px 22.3363px 17.869px rgba(0,0,0,0.0417275),0px 12.5216px 10.0172px rgba(0,0,0,0.035),0px 6.6501px 5.32008px rgba(0,0,0,0.0282725),0px 2.76726px 2.21381px rgba(0,0,0,0.0196802);"],(e=>{let{theme:t}=e;return t.colors.narrationCountdownBackground}),c.tF,(e=>{let{theme:t}=e;return t.colors.red}));var W=e=>{let{time:t,onCountdownComplete:i,onCountdown:r,initialDelay:o=.15,postDelay:a=.1}=e;const{0:s,1:l}=(0,n.useState)(t),d=(0,n.useRef)(s),c=(0,n.useRef)(),u=(0,n.useCallback)((()=>{r(d.current-1),l((e=>e-1))}),[r]);return(0,n.useEffect)((()=>(setTimeout((()=>{r(d.current),c.current=window.setInterval(u,1e3)}),1e3*o),()=>clearInterval(c.current))),[u,o,r]),(0,n.useEffect)((()=>{d.current=s,0===s&&(setTimeout((()=>i()),1e3*a),clearInterval(c.current))}),[s,i,a]),(0,A.jsxs)($,{"data-testid":"countdown",children:[" ",Math.max(s,1)," "]})};var F=class{constructor(){(0,b.Z)(this,"audioCtx",void 0),(0,b.Z)(this,"soundBuffers",{}),(0,b.Z)(this,"soundBufferSources",{}),window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioCtx=new window.AudioContext}async prepareSoundBuffer(e){return new Promise(((t,i)=>{this.audioCtx.decodeAudioData(e,(e=>{t(e)}),(e=>{i(e)}))}))}async setupSound(e){const t=await fetch(e),i=await t.arrayBuffer(),n=await this.prepareSoundBuffer(i);this.soundBuffers[e]=n,this.prepareBufferSource(e)}playSound(e){var t;null===(t=this.soundBufferSources[e])||void 0===t||t.start(),this.prepareBufferSource(e)}teardown(){this.soundBuffers={},this.soundBufferSources={},this.audioCtx.close()}prepareBufferSource(e){const t=this.audioCtx.createBufferSource();t.buffer=this.soundBuffers[e],t.connect(this.audioCtx.destination),this.soundBufferSources[e]=t}};const V="/assets/countdown_1.mp3",B="/assets/countdown_2.mp3",J="/assets/countdown_3.mp3";var G=(0,n.forwardRef)(((e,t)=>{const i=(0,n.useRef)(null);return(0,n.useEffect)((()=>(i.current=new F,i.current.setupSound(V),i.current.setupSound(B),i.current.setupSound(J),()=>{var e;null===(e=i.current)||void 0===e||e.teardown()})),[]),(0,n.useImperativeHandle)(t,(()=>({playSoundOne:()=>{var e;null===(e=i.current)||void 0===e||e.playSound(V)},playSoundTwo:()=>{var e;null===(e=i.current)||void 0===e||e.playSound(B)},playSoundThree:()=>{var e;null===(e=i.current)||void 0===e||e.playSound(J)}}))),null})),Y=i(13285);const K=x.ZP.div.withConfig({displayName:"Overlaystyles__OverlayProgressWrapper",componentId:"sc-1u6i9bn-0"})(["position:absolute;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;"]),q=x.ZP.div.withConfig({displayName:"Overlaystyles__DragZone",componentId:"sc-1u6i9bn-1"})(["left:0;bottom:0;right:0;position:absolute;",""],(e=>e.inDrag&&(0,x.iv)(["z-index:",";"],c.Dl-1))),X=(0,x.ZP)(Y.E.div).withConfig({displayName:"Overlaystyles__Dragger",componentId:"sc-1u6i9bn-2"})(["position:absolute;width:64px;height:64px;right:0;top:0;z-index:",";pointer-events:auto;display:",";&:hover{cursor:pointer;}"],c.Dl,(e=>e.$hide?"none":"inherit")),Q=(0,x.ZP)(Y.E.div).withConfig({displayName:"Overlaystyles__DragTarget",componentId:"sc-1u6i9bn-3"})(["position:absolute;width:","px;height:","px;border-radius:","px;background-color:",";opacity:0.4;z-index:",";"],(e=>e.size),(e=>e.size),(e=>e.size),(e=>e.theme.colors.contentAccent),c.Dl),ee=(0,x.ZP)(Q).withConfig({displayName:"Overlaystyles__TargetUL",componentId:"sc-1u6i9bn-4"})(["top:0;left:0;"]),te=(0,x.ZP)(Q).withConfig({displayName:"Overlaystyles__TargetUR",componentId:"sc-1u6i9bn-5"})(["top:0;right:0;"]),ie=((0,x.ZP)(Q).withConfig({displayName:"Overlaystyles__TargetBR",componentId:"sc-1u6i9bn-6"})(["bottom:0;right:0;"]),(0,x.ZP)(Q).withConfig({displayName:"Overlaystyles__TargetBL",componentId:"sc-1u6i9bn-7"})(["bottom:0;left:0;"]),(0,x.ZP)(Y.E.div).withConfig({displayName:"Overlaystyles__OverlayContainer",componentId:"sc-1u6i9bn-8"})(["position:absolute;top:0;right:0;width:64px;height:64px;background-color:transparent;z-index:",";display:",";"],c.Dl,(e=>e.$hide?"none":"inherit"))),ne=(0,x.ZP)(Y.E.div).withConfig({displayName:"Overlaystyles__VisibilityContainer",componentId:"sc-1u6i9bn-9"})(["visibility:",";position:absolute;"],(e=>e.$visibility?"visible":"hidden")),re=x.ZP.div.withConfig({displayName:"Overlaystyles__CountdownScrim",componentId:"sc-1u6i9bn-10"})(["z-index:1;position:absolute;background-color:",";width:100%;height:100%;display:flex;align-items:center;justify-content:center;"],(e=>e.theme.colors.countdownScrim)),oe=x.ZP.div.withConfig({displayName:"Overlaystyles__OverlayLayer",componentId:"sc-1u6i9bn-11"})(["position:",";left:0;right:0;bottom:0;z-index:999;pointer-events:none;"],(e=>e.$isMobile?"sticky":"absolute")),ae=x.ZP.div.withConfig({displayName:"Overlaystyles__StickyWrapper",componentId:"sc-1u6i9bn-12"})(["position:sticky;top:0;height:76px;overflow:visible;pointer-events:none;"]),se=(e,t)=>[-e+t+12,-12,12];var le;!function(e){e.DEFAULT="default",e.HIDDEN="hidden",e.DRAGGING="dragging",e.CLICKED="clicked"}(le||(le={}));const de=e=>{let{overlayData:t,pageId:i,tomeId:b,canEdit:I,display:P,pageHeight:x,pageWidth:T,isMobile:O,playMode:R}=e;const{t:C}=(0,s.$G)(),j=(0,r.sJ)(_.wo),{apolloClient:E,clientId:S}=(0,p.bp)(),k=(0,r.sJ)((0,h.vw)(i)),Z=(0,r.rb)((0,h.vw)(i)),{localMediaUrl:L}=k,H=(0,y.f3)()===m.Z.RECORD,M=H||j,z=(0,n.useRef)(null),N=!!L||t.videoStatus===u.Kwn.Ready,{0:$,1:F}=(0,n.useState)(!1),{0:V,1:B}=(0,n.useState)(!1),{0:J,1:Y}=(0,n.useState)(!1),{0:Q,1:de}=(0,n.useState)(!1),{0:ce,1:ue}=(0,n.useState)(!1),pe=(0,n.useRef)(),ge=!M&&!N,{0:he,1:fe}=(0,n.useState)(le.DEFAULT),{0:me,1:ye}=(0,n.useState)(!1),ve=(0,n.useRef)(!1),we=(0,o._)(),be=(0,n.useRef)(null),Ie=(0,a.c)(0),Pe=(0,a.c)(0),{0:xe,1:Te}=(0,n.useState)(t.position||u._zJ.UpperRight),Oe=k.inProgress;(0,n.useEffect)((()=>{t.position&&Te(t.position)}),[t.position]),(0,n.useEffect)((()=>{P&&he===le.HIDDEN&&fe(le.DEFAULT),P||fe(le.HIDDEN)}),[P,he]);const Re=(0,n.useCallback)((()=>{if(be.current&&t.position){const e=se(T,64),[i,n]=((e,t)=>{const[,i]=e.toString().split("_"),n=t[2];let r;return r="LEFT"===i?t[0]:t[1],[r,n]})(t.position,e);Ie.set(i),Pe.set(n)}}),[t.position,T,64,Ie,Pe]);(0,n.useEffect)((()=>{Re()}),[Re]),(0,n.useEffect)((()=>{j&&$?(ue(!1),de(!0)):j||(ue(!1),de(!1))}),[j,$]),(0,n.useEffect)((()=>{var e,t;j&&(null!==(e=z.current)&&void 0!==e&&e.isPlaying()&&(null===(t=z.current)||void 0===t||t.toggleVideo()))}),[j]),(0,n.useEffect)((()=>{t.videoStatus===u.Kwn.Ready&&Z()}),[t.videoStatus,Z]);const Ce=(0,n.useCallback)(((e,t)=>{if(fe(le.DEFAULT),be.current){const[e,n,r]=se(T,64),o=e/2,a=1500;let s,d;Ie.get()<o?(s=e,d="LEFT",t.velocity.x>a&&(s=n,d="RIGHT")):(s=n,d="RIGHT",t.velocity.x<-a&&(s=e,d="LEFT"));const c=r,u=`${"UPPER"}_${d}`;u!==xe&&(Te(u),I&&!O&&(0,l.I2)(b,i,E,S,u)),we.start({x:s,y:c,transition:{duration:.1}}).then((()=>{ye(!1),ve.current=!1})),setTimeout((()=>fe(le.DEFAULT)),240)}}),[E,I,S,xe,Ie,we,O,i,T,b]),je=(0,n.useCallback)((()=>{Z(),(0,l.Np)(b,i,E,S)}),[E,S,i,Z,b]),Ee=(0,n.useCallback)((e=>{var t,i,n;switch(e){case 3:null===(t=pe.current)||void 0===t||t.playSoundOne();break;case 2:null===(i=pe.current)||void 0===i||i.playSoundTwo();break;case 1:null===(n=pe.current)||void 0===n||n.playSoundThree()}}),[]),Se=(0,n.useCallback)((()=>{ue(!0),de(!1)}),[]);return(0,A.jsxs)(A.Fragment,{children:[Q&&(0,A.jsx)(d.Z,{top:0,left:0,zIndex:c.y$,fullscreen:!0,children:(0,A.jsx)(re,{children:(0,A.jsx)(W,{time:3,onCountdownComplete:Se,onCountdown:Ee})})}),M&&(0,A.jsx)(G,{ref:pe}),(0,A.jsx)(q,{inDrag:me,"data-tome-bypass-tap-navigation":"Overlay__DragZone",style:{height:O?0:x,width:O?0:T,top:"calc(var(--mobile-header-top-padding, 0px))"},children:(0,A.jsxs)(ae,{ref:be,style:{top:"calc(var(--mobile-header-top-padding, 0px))",width:T},children:[(0,A.jsx)(ee,{size:64,animate:he,variants:D.$S,initial:le.DEFAULT}),(0,A.jsx)(te,{size:64,animate:he,variants:D.$S,initial:le.DEFAULT})]})}),(0,A.jsx)(oe,{"data-tome-bypass-tap-navigation":"Overlay__OverlayLayer",$isMobile:O,style:{height:O?0:x,width:O?0:T,top:"calc(var(--mobile-header-top-padding, 0px))",transition:"top 0.2s ease-in-out"},children:(0,A.jsx)(ae,{style:{width:T},children:(0,A.jsxs)(ie,{style:{x:Ie,y:Pe},variants:D.IR,animate:he,$hide:ge,children:[(0,A.jsx)(ne,{$visibility:!J,children:(0,A.jsx)(U,{pageId:i,tomeId:b,enableVideo:(!N||j)&&M,checkForMediaDevices:H,enableRecording:j&&ce,setCanPlay:F,setScaledUp:B})}),(0,A.jsx)(w.Z,{shouldAnimateIn:O||R,shouldBeVisible:N&&!$&&!V,ref:z,localMediaUrl:L,overlayData:t,setPlaybackPlaying:Y,isInRecordMode:M,isMobile:O,tomeId:b}),Oe&&(0,A.jsx)(K,{"data-testid":"overlay_progress",children:(0,A.jsx)(f.Z,{width:24,height:24,progress:k.progress,infinite:1===k.progress})},"progressIndicator")]})})}),(0,A.jsxs)(oe,{"data-tome-bypass-tap-navigation":"Overlay__OverlayLayer","data-testid":"av_overlay_layer",$isMobile:O,style:{height:O?0:x,width:O?0:T,top:"calc(var(--mobile-header-top-padding, 0px))"},children:[(0,A.jsx)(ae,{style:{width:T},onMouseDown:e=>{e.stopPropagation()},children:(0,A.jsx)(g.Z,{menuWidth:140,menuPosition:"below",menuAlign:"click",rightClickActivated:!0,disabled:!I,itemsOrFn:[{text:C("overlay.delete"),action:je,variant:"destructive"}],children:(0,A.jsx)(X,{"data-testid":"av_overlay_dragger",$hide:ge,drag:(I||O)&&!j,dragConstraints:be,animate:we,style:{x:Ie,y:Pe},onDrag:()=>{var e;fe(le.DRAGGING),null===(e=document.querySelector(".ProseMirror-focused"))||void 0===e||e.blur()},onDragStart:()=>{ye(!0),ve.current=!0},onDragEnd:Ce,onTap:()=>{Oe||(j||!z.current||ve.current||z.current.toggleVideo(),fe(le.DEFAULT))},onMouseDown:()=>{fe(le.CLICKED)}})})}),he===le.DRAGGING&&(0,A.jsx)(v.Z,{})]})]})};var ce=e=>{let{overlayData:t,pageId:i,tomeId:n,canEdit:r,display:o,pageHeight:a,pageWidth:s,isMobile:l,playMode:d}=e;return t?(0,A.jsx)(de,{overlayData:t,pageId:i,canEdit:r,tomeId:n,display:o,pageHeight:Number.isNaN(a)?0:a,pageWidth:Number.isNaN(s)?0:s,isMobile:l,playMode:d}):null}},35464:function(e,t,i){i.d(t,{$S:function(){return n},DO:function(){return a},IR:function(){return r},p3:function(){return o}});const n={default:{scale:0,opacity:0,transition:{opacity:{duration:.35,ease:[.4,0,.1,1],delay:.25},scale:{type:"spring",stiffness:550,damping:30,delay:.25}}},dragging:{scale:.5,opacity:.75,transition:{opacity:{duration:.5,ease:[.4,0,.1,1],delay:.3},scale:{type:"spring",stiffness:550,damping:30,delay:.3}}}},r={default:{scale:1,opacity:1,transition:{opacity:{duration:.3,ease:[.4,0,.1,1],delay:.3}}},clicked:{scale:.95,opacity:1},dragging:{scale:1.1,opacity:1},hidden:{opacity:0,transition:{opacity:{duration:.1,ease:[.4,0,.1,1]}}}},o=1.5,a=1.15},22124:function(e,t,i){i.d(t,{U:function(){return o},Y:function(){return a}});var n=i(59016),r=i(13285);const o=(0,n.ZP)(r.E.div).withConfig({displayName:"OverlayVideo__VideoWrapper",componentId:"sc-1xfsogz-0"})(["position:relative;display:flex;align-items:center;justify-content:center;width:",";height:",";background-color:transparent;filter:drop-shadow(0px 6px 16px rgba(0,0,0,0.25));border-radius:50%;overflow:hidden;",";"],(e=>{let{$useSmallSize:t}=e;return t?"48px":"64px"}),(e=>{let{$useSmallSize:t}=e;return t?"48px":"64px"}),(e=>{let{$hasBorder:t}=e;return t&&(0,n.iv)(["::after{content:' ';position:absolute;left:0;right:0;top:0;bottom:0;border-radius:50%;border:1px solid rgba(255,255,255,0.12);pointer-events:none;}"])})),a=n.ZP.video.withConfig({displayName:"OverlayVideo__VideoPlayer",componentId:"sc-1xfsogz-1"})(["position:absolute;top:50%;left:50%;min-height:100%;min-width:100%;width:100%;height:100%;object-fit:cover;visibility:",";",";"],(e=>{let{$visible:t}=e;return t?"inherited":"hidden"}),(e=>{let{$isFlipped:t}=e;return t&&(0,n.iv)(["transform:translate(-50%,-50%) scaleX(-1);"])}))},41100:function(e,t,i){i.d(t,{f:function(){return S},Z:function(){return k}});var n=i(59499),r=i(67294),o=i(67631),a=i.n(o),s=i(95421),l=i(13285),d=i(4480),c=i(51718),u=i(22124),p=i(35464),g=i(59016),h=i(85518),f=i(7034),m=i(17009),y=i(60864),v=i(24306),w=i(85893);function b(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function I(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?b(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):b(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var P=(0,r.forwardRef)(((e,t)=>(0,w.jsxs)(v.Z,I(I({ref:t,viewBox:"0 0 64 64"},e),{},{children:[(0,w.jsx)(l.E.path,{d:"M7.00164 23.0283C5.3444 23.0279 4.00057 24.3711 4 26.0283L4.00001 38.03C4.00045 39.6873 5.34425 41.0304 7.00151 41.03H12.5089C13.5698 41.0299 14.5873 41.451 15.3379 42.2006L23.5817 50.4356C23.9569 50.8103 24.4654 51.0209 24.9957 51.0212C26.1015 51.0217 26.9984 50.1258 26.9989 49.02V15.03C26.9986 14.5001 26.7882 13.9918 26.4137 13.6168C25.6326 12.8347 24.3654 12.8339 23.5832 13.6149L15.331 21.8576C14.5805 22.6073 13.5631 23.0284 12.5022 23.0283H7.00164Z",fill:"currentColor"}),(0,w.jsx)(l.E.path,{fill:"currentColor",d:"M30.5893 17.7952C31.1051 16.5742 32.5131 16.0026 33.7341 16.5185C39.7623 19.0654 44 25.0349 44 31.9998C44 38.9646 39.7623 44.9342 33.7341 47.4811C32.5131 47.997 31.1051 47.4254 30.5893 46.2044C30.0734 44.9834 30.645 43.5754 31.866 43.0595C36.18 41.2368 39.2 36.9682 39.2 31.9998C39.2 27.0313 36.18 22.7627 31.866 20.94C30.645 20.4241 30.0734 19.0161 30.5893 17.7952Z",animate:{opacity:[0,1,1,0]},transition:{times:[.19,.2,.4,.41],duration:3,repeat:1/0,type:"linear"}}),(0,w.jsx)(l.E.path,{fill:"currentColor",d:"M38.0314 12.2418C38.7897 11.1546 40.2857 10.8881 41.3729 11.6464C47.7919 16.1238 51.9998 23.5702 51.9998 31.9998C51.9998 40.4294 47.7919 47.8758 41.3729 52.3532C40.2857 53.1116 38.7897 52.845 38.0314 51.7578C37.2731 50.6707 37.5396 49.1747 38.6268 48.4164C43.814 44.7981 47.1998 38.7942 47.1998 31.9998C47.1998 25.2054 43.814 19.2015 38.6268 15.5833C37.5396 14.8249 37.2731 13.3289 38.0314 12.2418Z",animate:{opacity:[0,1,1,0]},transition:{times:[.39,.4,.6,.61],duration:3,repeat:1/0,type:"linear"}}),(0,w.jsx)(l.E.path,{fill:"currentColor",d:"M45.0151 7.2481C45.8721 6.23699 47.3866 6.11211 48.3977 6.96918C55.4913 12.982 60 21.9657 60 32C60 42.0342 55.4913 51.0179 48.3977 57.0307C47.3866 57.8878 45.8721 57.7629 45.0151 56.7518C44.158 55.7407 44.2829 54.2262 45.294 53.3692C51.3576 48.2294 55.2 40.5646 55.2 32C55.2 23.4353 51.3576 15.7705 45.294 10.6307C44.2829 9.77366 44.158 8.25921 45.0151 7.2481Z",animate:{opacity:[0,1,1,0]},transition:{times:[.59,.6,.8,.81],duration:3,repeat:1/0,type:"linear"}})]}))));function x(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function T(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?x(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const O=(0,g.ZP)(l.E.div).withConfig({displayName:"OverlayTooltip__PositionedContainer",componentId:"rx1vxm-0"})(["position:relative;"]);var R=e=>{let{videoWrapperRef:t,showTooltip:i,position:n,tooltipCopy:o=f.ZP.t("overlay.overlayTooltip.tooltipCopy"),shouldScale:a=!0}=e;const s=(0,g.Fg)(),l=(0,r.useRef)(null),{0:d,1:u}=(0,r.useState)({top:0,left:0});(0,r.useEffect)((()=>{var e,i;const r=null===(e=l.current)||void 0===e?void 0:e.getBoundingClientRect(),o=null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect();if(o&&r){const e=h.tq||!a?1:(0,y.k6)(),t=(-o.height/2-r.height/2)/e;let i=0;switch(n){case c._zJ.UpperRight:i=-r.width/e-10;break;case c._zJ.UpperLeft:i=o.width/e+10;case c._zJ.BottomRight:case c._zJ.BottomLeft:}u({top:t,left:i})}}),[n,t,a]);let p=10;switch(n){case c._zJ.UpperRight:case c._zJ.BottomRight:p=-10}return(0,w.jsx)(O,{initial:{opacity:0},animate:{opacity:i?1:0,scale:i?1:.9},transition:{type:"tween",duration:.5},style:T({},d),children:(0,w.jsx)(m.DY,{animate:{x:[p,0,p]},transition:{repeat:1/0,type:"spring",duration:3,delay:.55},children:(0,w.jsxs)(m._v,{ref:l,$background:s.colors.tooltipOnSheetBg,children:[o,(0,w.jsx)(P,{style:{width:14,height:14,verticalAlign:"bottom",margin:"0 2"}})]})})})},C=i(40461);function j(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function E(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?j(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):j(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}let S;var D;!function(e){e[e.NORMAL=0]="NORMAL",e[e.SMALL=1]="SMALL"}(S||(S={})),function(e){e[e.STOPPED=0]="STOPPED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED"}(D||(D={}));const _={initialWithBounce:{scale:0},withBounce:{scale:1,transition:{type:"spring",bounce:.5}},initialWithOutBounce:{scale:1},withoutBounce:{scale:1}};var k=(0,r.forwardRef)(((e,t)=>{let{overlayData:i,setPlaybackPlaying:n,isInRecordMode:o,isMobile:g,localMediaUrl:h,shouldBeVisible:f,shouldAnimateIn:m,videoProps:y,tooltipCopy:v,shouldScaleTooltip:b,size:I=S.NORMAL,tomeId:P,forceLoad:x=!1}=e;const{videoUrl:T,videoThumbnailUrl:O,videoStatus:j}=i,k=!!h,A=j===c.Kwn.Ready,Z=k&&h?h:T||void 0,L=k?"":O||void 0,H=(0,r.useRef)(null),M=(0,r.useRef)(null),{0:z,1:N}=(0,r.useState)(D.STOPPED),{0:U,1:$}=(0,r.useState)(!1),{0:W,1:F}=(0,r.useState)(!1),V=(0,r.useRef)(void 0),[B,J]=(0,d.FV)((0,C.K3)(P));(0,r.useEffect)((()=>{N(D.STOPPED)}),[Z]),(0,r.useEffect)((()=>{if(L&&m){const e=new Image;$(!0),e.src=L,e.onload=()=>{$(!1)}}}),[m,L]),(0,r.useEffect)((()=>{const e=M.current;if(!k&&A&&e&&Z&&!Z.includes(".mp4")&&a().isSupported()){const t=new(a());t.on(a().Events.MEDIA_ATTACHED,(()=>{t.loadSource(Z)})),t.attachMedia(e)}}),[Z,k,A]),(0,r.useEffect)((()=>{var e;x&&(null===(e=M.current)||void 0===e||e.load())}),[Z,x]);const G=(0,r.useCallback)((()=>{F(!1),M.current&&(z!==D.PLAYING?V.current=M.current.play():void 0!==V.current&&V.current.then((()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.pause()})))}),[z]),Y=(0,r.useCallback)((e=>{M.current&&(M.current.currentTime=e)}),[]),K=(0,r.useCallback)((()=>{if(M.current)return M.current.currentTime}),[]),q=(0,r.useCallback)((()=>z===D.PLAYING),[z]);(0,r.useImperativeHandle)(t,(()=>({toggleVideo:G,isPlaying:q,setCurrentTime:Y,currentTime:K})));const X=g?p.DO:p.p3,Q={playback:{scale:z===D.PLAYING?X:1}},ee=(0,r.useCallback)((()=>{N(D.PLAYING),n(!0),J(!0)}),[J,n]),te=(0,r.useCallback)((()=>{N(D.PAUSED),n(!1)}),[n]),ie=(0,r.useCallback)((()=>{N(D.STOPPED),n(!1)}),[n]);(0,r.useEffect)((()=>{m||F(!1)}),[m]);let ne="withoutBounce";return m&&(ne=U?"initialWithBounce":"withBounce"),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(s.M,{children:f&&(0,w.jsx)(l.E.div,{initial:m?"initialWithBounce":"initialWithoutBounce",animate:ne,onAnimationComplete:e=>{m&&!o&&"withBounce"===e&&F(!0)},variants:_,children:(0,w.jsx)(u.U,{animate:["playback"],variants:Q,style:{translateZ:"0"},ref:H,$useSmallSize:I===S.SMALL,$hasBorder:!0,children:(k||A)&&(0,w.jsx)(u.Y,E({controls:!1,ref:M,src:Z,playsInline:!0,$isFlipped:!0,$visible:!0,onPlay:ee,onPause:te,onEnded:ie,poster:L,"data-isavoverlay":"true","data-testid":(A?"remote":"local")+"_overlay_video"},y))})},"playbackOverlay")}),W&&!B&&(0,w.jsx)(R,{tooltipCopy:v,showTooltip:W,videoWrapperRef:H,position:i.position??c._zJ.UpperRight,shouldScale:b})]})}))},40461:function(e,t,i){i.d(t,{$6:function(){return o},HV:function(){return s},K3:function(){return u},LW:function(){return l},ep:function(){return d},fT:function(){return c},jd:function(){return r},wo:function(){return a}});var n=i(4480);const r=(0,n.cn)({key:"audioDevicesState",default:[]}),o=(0,n.cn)({key:"videoDevicesState",default:[]}),a=(0,n.cn)({key:"desiredRecordingStateState",default:!1}),s=(0,n.cn)({key:"videoDeviceIdState",default:null}),l=(0,n.cn)({key:"audioDeviceIdState",default:null}),d=(0,n.cn)({key:"overlayRecordingErrorsState",default:"NONE"}),c=(0,n.cn)({key:"overlayStatusState",default:"idle"}),u=(0,n.xu)({key:"hasAnOverlayBeenPlayedState",default:!1})},92627:function(e,t,i){i.d(t,{e:function(){return a}});var n=i(67294),r=i(85893);const o=n.createContext({}),a=e=>{let{children:t}=e;const i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)(null),l=(0,n.useCallback)((e=>{const t=i.current===e;e&&!t&&(i.current=e,e.scrollTop=0,s.current&&s.current(),a.current=null,s.current=null)}),[]),d=(0,n.useCallback)((e=>{a.current=e}),[]),c=(0,n.useCallback)((e=>{s.current=e}),[]);return(0,r.jsx)(o.Provider,{value:{scrollingPageRef:i,setScrollingPageRef:l,pageScrollTopAnimatedToRef:a,setPageScrollTopAnimatedToRef:d,pageScrollAnimationStopRef:s,setPageScrollAnimationStopRef:c},children:t})};t.Z=o},39626:function(e,t,i){let n;function r(e){let{widthToBeSquishedInUnits:t,deltaInUnits:i,numSquishedTiles:n,totalUnitsAvailable:r}=e,o=!1;const a=t-i;let s;return a<n?(o=!0,s=n):s=Math.round(a),{sideInUnits:s,otherSideInUnits:r-s,reachedMinimum:o}}function o(e){let{numOfLeftTilesToAdj:t,numOfRightTilesToAdj:i,leftWidthInUnitsPreResize:n,rightWidthInUnitsPreResize:o,deltaInUnits:a}=e;const s=n+o;let l,d,c;a<0?(c=r({widthToBeSquishedInUnits:n,deltaInUnits:-a,numSquishedTiles:t,totalUnitsAvailable:s}),l=c.sideInUnits,d=c.otherSideInUnits):(c=r({widthToBeSquishedInUnits:o,deltaInUnits:a,numSquishedTiles:i,totalUnitsAvailable:s}),d=c.sideInUnits,l=c.otherSideInUnits);return{leftTileWidthInUnits:l/t,rightTileWidthInUnits:d/i,reachedMinimum:c.reachedMinimum}}function a(e){let{leftWidthInUnitsPreResize:t,rightWidthInUnitsPreResize:i,numOfLeftTilesToAdj:n,numOfRightTilesToAdj:r,deltaPx:o}=e;return o<0&&t<=n||o>0&&i<=r}i.d(t,{e9:function(){return o},jm:function(){return a},yV:function(){return n}}),function(e){e.NOOP="noop",e.REACHED_MINIMUM="reached_minimum",e.SUCCESS="success"}(n||(n={}))},27453:function(e,t,i){i.d(t,{Z:function(){return h}});var n=i(67294),r=i(24656),o=i(24418),a=i(40556),s=i(59499);var l=i(67156),d=i(20543),c=i(18036),u=i(90370),p=i(39626);var g=class{constructor(e,t,i,n,r,o){(0,s.Z)(this,"frontendPageLayout",void 0),(0,s.Z)(this,"persistLayout",void 0),(0,s.Z)(this,"tileRefs",void 0),(0,s.Z)(this,"rowHeights",void 0),(0,s.Z)(this,"tileWidths",void 0),(0,s.Z)(this,"triggerRender",void 0),(0,s.Z)(this,"pixelsPerHeightUnit",void 0),(0,s.Z)(this,"rowHeightPreResize",void 0),(0,s.Z)(this,"rowPadding",void 0),this.frontendPageLayout=d.Z.fromLayout(e,t),this.persistLayout=i,this.tileRefs=new Map,this.pixelsPerHeightUnit=n,this.rowPadding=r,this.triggerRender=o,this.rowHeights=new Map,this.tileWidths=new Map,this.updateActualHeights(),this.updateAllTileWidths(),this.rowHeightPreResize=void 0}update(e,t,i,n,r){const o=d.Z.fromLayout(e,t);this.persistLayout=i,this.pixelsPerHeightUnit=n,this.rowPadding=r,o.isEquivalentTo(this.frontendPageLayout)||(this.frontendPageLayout=o,this.rowHeights.clear(),this.tileWidths.clear(),this.updateActualHeights(),this.updateAllTileWidths())}isSingleTile(e){return this.frontendPageLayout.isSingleTile(e)}getRowHeight(e){return this.rowHeights.get(e)}getTileHeightInPx(e){const t=this.rowHeights.get(e);return void 0===t?t:t*this.pixelsPerHeightUnit-this.rowPadding}triggerLayoutRecalculationAndRender(){this.updateActualHeights(),this.triggerRender()}findNoopDropzones(e){return this.frontendPageLayout.findNoopDropzones(e)}tileRefCallback(e){return t=>{null!==t?this.tileRefs.set(e,t):this.tileRefs.delete(e)}}sumOfRowHeightsInUnits(){return Array.from(this.rowHeights.values()).reduce(((e,t)=>e+t),0)}getTilePosition(e,t,i){const n=this.frontendPageLayout.rowByTileId(e);if(void 0===n)throw new Error(`Row not found for tile ${e}`);let r=0;for(const l of this.frontendPageLayout.rows){if(n.id===l.id)break;r+=this.getRowHeight(l.id)}let o=0;for(const l of n.tiles){if(l.tileId===e)break;o+=this.getTileWidthInPx(l.tileId,t,i)??0}const a=r*this.pixelsPerHeightUnit+i,s=this.getTileWidthInPx(e,t,i)??0;return{top:a,left:o+i*(n.tiles.findIndex((t=>t.tileId===e))+1),width:s,height:this.getRowHeight(n.id)*this.pixelsPerHeightUnit-i}}getTileRowId(e){var t;return null===(t=this.frontendPageLayout.rowByTileId(e))||void 0===t?void 0:t.id}addTileToNewRow(e,t,i){const n=this.frontendPageLayout.addTileToNewRow(e,{kind:c.DV.NEW_TILE},t,i,this.getRowHeight.bind(this));return this.updateRowHeightsAndTileWidthsAfterLayoutChange(),n}addTileToExistingRow(e,t,i,n,r){const o=this.frontendPageLayout.addTileToExistingRow(e,t,i,n,r,this.getRowHeight.bind(this));return this.updateRowHeightsAndTileWidthsAfterLayoutChange(),o}addTileToEndOfPage(e,t,i){const n=this.frontendPageLayout.addTileToEndOfPage(e,t,i,this.getRowHeight.bind(this));return this.updateRowHeightsAndTileWidthsAfterLayoutChange(),n}deleteTile(e){this.frontendPageLayout.deleteTile(e,this.getRowHeight.bind(this)),this.updateRowHeightsAndTileWidthsAfterLayoutChange()}moveTile(e,t){this.conditionallyUpdateAndPersistLayout((i=>(i.moveTile(e,t,this.getRowHeight.bind(this)),!0)))}getRowResizeHandlers(e){return{handleResizeStart:()=>{this.rowHeightPreResize=this.getRowHeight(e)},handleResize:t=>{const i=function(e,t,i){const n=t+Math.round(e);return Math.max(n,i)}(t/this.pixelsPerHeightUnit,this.rowHeightPreResize,this.getRowMinimumHeight(e));this.rowHeights.get(e)!==i&&(this.rowHeights.set(e,i),this.updateActualHeights(e),this.triggerRender())},handleResizeComplete:()=>{const t=this.getRowHeight(e),i=this.frontendPageLayout.getTileTypesForRow(e).map((e=>(0,u.g)(e))).every((e=>e===u.Y.FIXED));let n;n=t===this.getRowMinimumHeight(e)&&i?null:t/l.Cj,this.updateRowHeight(e,n),this.rowHeightPreResize=void 0}}}sumTileWidthsInUnits(e){let{row:t,start:i,end:n}=e;return t.tiles.slice(i,n).reduce(((e,t)=>e+(this.tileWidths.get(t.tileId)??0)),0)*l.w4}getTileResizeHandlers(e,t,i){var n=this;let r,o,a,s,d=!1;return{handleResizeStart:function(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d=i;const l=n.frontendPageLayout.rowById(t);l&&(r=n.sumTileWidthsInUnits({row:l,start:d?e-1:0,end:e}),o=n.sumTileWidthsInUnits({row:l,start:e,end:d?e+1:void 0}),a=d?1:e,s=d?1:l.numTiles()-e)},handleResize:n=>{const c=this.frontendPageLayout.rowById(t);if(!c)return p.yV.NOOP;if(0===n)return p.yV.NOOP;if((0,p.jm)({numOfLeftTilesToAdj:a,numOfRightTilesToAdj:s,leftWidthInUnitsPreResize:r,rightWidthInUnitsPreResize:o,deltaPx:n}))return p.yV.REACHED_MINIMUM;const u=n/i*l.w4,g=(0,p.e9)({numOfLeftTilesToAdj:a,numOfRightTilesToAdj:s,leftWidthInUnitsPreResize:r,rightWidthInUnitsPreResize:o,deltaInUnits:u}),h=g.leftTileWidthInUnits/l.w4,f=g.rightTileWidthInUnits/l.w4,m=d?c.tiles.slice(e-1,e+1):c.tiles,y=d?1:e;return m.forEach(((e,t)=>{t<y?this.tileWidths.set(e.tileId,h):this.tileWidths.set(e.tileId,f)})),this.triggerRender(),g.reachedMinimum?p.yV.REACHED_MINIMUM:p.yV.SUCCESS},handleResizeComplete:()=>{const e=this.frontendPageLayout.rowById(t);if(!e)return;const i=new Map;e.tiles.forEach((e=>{i.set(e.tileId,this.tileWidths.get(e.tileId))})),this.updateTileWidths(t,i)}}}distributeWidths(e){const t=this.frontendPageLayout.rowById(e);if(!t)return;const i=t.getDistributedRelativeWidth(),n=new Map;t.tiles.forEach((e=>{this.tileWidths.set(e.tileId,i),n.set(e.tileId,i)})),this.triggerRender(),this.updateTileWidths(e,n)}alreadyEvenlyDistributed(e){const t=this.frontendPageLayout.rowById(e);if(!t)return!0;const i=t.getDistributedRelativeWidth();return t.tiles.every((e=>e.relativeWidth===i))}tileNeighborByDirection(e,t,i){return this.frontendPageLayout.tileNeighborByDirection(e,t,i)}getTileWidthInPx(e,t,i){if(void 0===this.frontendPageLayout.rowByTileId(e))return;return(t-i)*this.tileWidths.get(e)-i}getTileWidthInUnits(e){if(!this.frontendPageLayout.rowByTileId(e))return;return this.tileWidths.get(e)*l.w4}getTileWidthPercentage(e){const t=this.frontendPageLayout.rowByTileId(e);if(void 0===t)throw new Error(`Row not found for tile ${e}`);const i=t.tileById(e);if(void 0===i)throw new Error(`Tile not found in row ${t.id}`);return i.relativeWidth/t.relativeWidthSum()}getLastRowHeightIfLastRow(e){if(this.frontendPageLayout.lastRow.id===e)return this.lastRowHeight()}getRowMinimumHeight(e){return(0,c.nA)(this.getHeightsForRowFromTiles(this.frontendPageLayout.rowById(e)),this.getLastRowHeightIfLastRow(e))}updateRowHeight(e,t){this.conditionallyUpdateAndPersistLayout((i=>{const n=i.rowById(e);return!!n&&(n.row.relativeHeight=t,!0)}))}updateTileWidths(e,t){this.conditionallyUpdateAndPersistLayout((i=>{const n=i.rowById(e);return!!n&&(t.forEach(((e,t)=>{const i=n.tileById(t);i&&(i.relativeWidth=e)})),!0)}))}lastRowHeight(e){const t=e??this.rowHeights;let i=0;const n=this.frontendPageLayout.rows.map((e=>e.id));for(const[r,o]of t)n.includes(r)&&r!==this.frontendPageLayout.lastRow.id&&(i+=o);return l.Cj-i}getHeightsForRowFromTiles(e){const t=e.tiles.map((e=>e.tileId)),i=new Map([...this.tileRefs].filter((e=>{let[i]=e;return t.includes(i)})));return Array.from(i.values(),(e=>e.getHeight().addPixelsIfAppropriate(this.rowPadding).toUnits(this.pixelsPerHeightUnit)))}updateActualHeights(e){this.frontendPageLayout.rows.forEach((t=>{if(t.id===e)return;const i=(0,c.tn)(t.row.relativeHeight,this.getHeightsForRowFromTiles(t),this.getLastRowHeightIfLastRow(t.id));this.rowHeights.set(t.id,i)}))}updateAllTileWidths(){this.frontendPageLayout.rows.forEach((e=>{this.updateTileWidthsForRow(e.id)}))}updateTileWidthsForRow(e){const t=this.frontendPageLayout.rowById(e);if(void 0===t)throw new Error(`Row not found for row ${e}`);t.tiles.forEach((e=>{const t=this.getTileWidthPercentage(e.tileId);this.tileWidths.set(e.tileId,t)}))}setLastRowRelativeHeightIfNeeded(){const e=this.frontendPageLayout.lastRow;return!this.frontendPageLayout.getTileTypesForRow(e.id).map((e=>(0,u.g)(e))).every((e=>e===u.Y.FIXED))&&(!((e.row.relativeHeight??0)*l.Cj>=this.lastRowHeight())&&(e.row.relativeHeight=this.rowHeights.get(e.id)/l.Cj,!0))}conditionallyUpdateAndPersistLayout(e){const t=d.Z.copyFrom(this.frontendPageLayout);e(t)&&(this.frontendPageLayout.isEquivalentTo(t)||(this.frontendPageLayout=t,this.updateRowHeightsAndTileWidthsAfterLayoutChange(),this.persistLayout(this.frontendPageLayout.getLayout())))}updateRowHeightsAndTileWidthsAfterLayoutChange(){this.rowHeights.clear(),this.updateActualHeights(),this.tileWidths.clear(),this.updateAllTileWidths();this.setLastRowRelativeHeightIfNeeded()}};function h(e){let{tomeId:t,pageId:i,pageKind:s,layout:l,tiles:d,pixelsPerHeightUnit:c,rowPadding:u,persistToBackend:p}=e;const{addController:h,getController:f,removeController:m}=(0,n.useContext)(a.Z),{apolloClient:y,clientId:v}=(0,o.bp)(),{1:w}=(0,n.useState)(0),b=()=>{w((e=>e+1))},I=(0,n.useCallback)((e=>{(0,r.T)(t,{id:i,layout:e},y,v)}),[y,v,i,t]),P=p?I:()=>{};(0,n.useEffect)((()=>()=>{m(s,i)}),[i,s,m]);const x=new Map;void 0!==d&&null!==d&&d.forEach((e=>x.set(e.id,e.type)));let T=f(s,i);return T?T.update(l,x,P,c,u):(T=new g(l,x,P,c,u,b),h(s,i,T)),T}},88989:function(e,t,i){var n=i(67294),r=i(92627);t.Z=function(){let{delayMs:e=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{scrollingPageRef:t}=(0,n.useContext)(r.Z),i=(0,n.useRef)(),o=(0,n.useRef)(!1),a=(0,n.useRef)(),s=100,l=(0,n.useCallback)(((e,t)=>e>=t-s),[]),d=(0,n.useCallback)(((e,t)=>e<t+s),[]),c=(0,n.useCallback)((()=>{a.current&&clearTimeout(a.current),o.current=!0}),[]),u=(0,n.useCallback)((function(n){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o.current){if(r)return;o.current=!1}if(t.current){const r=t.current;null!==n&&void 0!==n&&n.clientY&&null!==n&&void 0!==n&&n.clientX&&(i.current={x:n.clientX,y:n.clientY});const o=r.getBoundingClientRect(),s=r.scrollHeight>o.height,c=r.scrollHeight-r.offsetHeight;if(!s)return;l(i.current.y,document.body.scrollHeight)&&r.scrollTop<c?(r.scrollTop+=1,a.current=setTimeout((()=>{u(null,!0)}),e)):d(i.current.y,0)&&r.scrollTop>0&&(r.scrollTop-=1,a.current=setTimeout((()=>{u(null,!0)}),e))}}),[e,l,d,t]);return(0,n.useMemo)((()=>({scrollContainerIfNeeded:u,cancelAnyScrolling:c})),[c,u])}},4832:function(e,t,i){i.d(t,{I:function(){return d}});var n=i(25675),r=i.n(n),o=i(67294),a=i(86062),s=i(98838),l=i(85893);const d=e=>!!e&&(e.shouldUseThemedLogo?!!e.imageUrlDark||!!e.imageUrlLight:!!e.imageUrlGlobal);t.Z=e=>{let{show:t,logo:i,theme:n}=e;const{0:d,1:c}=(0,o.useState)(!1),{UITheme:u}=(0,a.Z)(n.id,n.colors),p=((e,t)=>!e.shouldUseThemedLogo&&e.imageUrlGlobal?e.imageUrlGlobal:"light"===t&&e.imageUrlLight&&e.shouldUseThemedLogo?e.imageUrlLight:"dark"===t&&e.imageUrlDark&&e.shouldUseThemedLogo?e.imageUrlDark:void 0)(i,u);return p&&t?(0,l.jsx)(r(),{alt:"workspace-logo",draggable:!1,src:p,layout:"fixed",height:24,width:80,objectFit:"contain",objectPosition:0,loader:s.Z,style:{opacity:d?1:0},onLoad:()=>c(!0),"data-testid":"workspace_logo"}):null}},36828:function(e,t,i){i.d(t,{D:function(){return d},L:function(){return c}});var n=i(64310),r=i(50576),o=i(67294),a=i(4480),s=i(40461),l=i(34997);let d;function c(e){let{onStop:t=(()=>null)}=e;const i=(0,o.useRef)(null),c=(0,o.useRef)([]),u=(0,o.useRef)(null),p=(0,o.useRef)(null),g=(0,a.Zl)(s.fT),h=(0,a.Zl)(s.ep),f=(0,a.Zl)(s.jd),m=(0,a.Zl)(s.$6),y=(0,a.sJ)(s.LW),v=(0,a.sJ)(s.HV),w=(0,o.useCallback)((()=>{const e=[],t=[];(0,l.GE)()?navigator.mediaDevices.enumerateDevices().then((i=>{i.forEach((i=>{i.deviceId&&("audioinput"===i.kind?e.push(i):"videoinput"===i.kind&&t.push(i))})),0===e.length?f((e=>0===e.length?e:[])):f((t=>{const i=null===t||void 0===t?void 0:t.map((e=>e.deviceId)),n=null===t||void 0===t?void 0:t.map((e=>e.label));return(0,r.Z)(i,e.map((e=>e.deviceId)))&&(0,r.Z)(n,e.map((e=>e.label)))?t:e})),0===t.length?m((e=>0===e.length?e:[])):m((e=>{const i=null===e||void 0===e?void 0:e.map((e=>e.deviceId)),n=null===e||void 0===e?void 0:e.map((e=>e.label));return(0,r.Z)(i,t.map((e=>e.deviceId)))&&(0,r.Z)(n,t.map((e=>e.label)))?e:t}))})).catch((e=>{console.log(`${e.name}: ${e.message}`)})):(f((e=>0===e.length?e:[])),m((e=>0===e.length?e:[])))}),[f,m]),b=(0,o.useCallback)((async()=>{g("acquiring_media");const e={audio:!0,video:!0};y&&(e.audio={deviceId:y}),v&&(e.video={deviceId:v});try{if((0,l.t1)()){const t=await window.navigator.mediaDevices.getUserMedia(e);w(),u.current=t}g("idle"),h(d.NONE)}catch(t){n.v.addAction("getMediaStreamError",{error:t.name}),h(t.name),g("idle")}}),[g,y,v,h,w]),I=(0,o.useCallback)((async()=>{await window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).catch((e=>{n.v.addAction("getMediaStreamError",{error:e.name}),h(e.name),g("idle")})),w()}),[h,g,w]);(0,o.useEffect)((()=>{(0,l.DE)()||(n.v.addAction("getMediaStreamError",{error:d.UNSUPPORTED_BROWSER}),h(d.UNSUPPORTED_BROWSER)),w(),(0,l.GE)()&&(navigator.mediaDevices.ondevicechange=w)}),[w,h]);const P=(0,a._8)((e=>{let{snapshot:t}=e;return async()=>{const e=t.getLoadable(s.fT).getValue(),i="idle"===e||"stopped"===e;!u.current&&i&&await b()}}),[b]),x=(0,o.useCallback)((()=>{const e=new Blob(c.current,{type:"video/mp4"}),i=URL.createObjectURL(e);g("stopped"),t(i,e)}),[t,g]),T=e=>{let{data:t}=e;c.current.push(t)},O=(0,o.useCallback)((async()=>{if(h(d.NONE),p.current){p.current.getTracks().some((e=>"ended"===e.readyState))&&await b(),(0,l.DE)()?(i.current=new MediaRecorder(p.current),i.current.ondataavailable=T,i.current.onstop=x,i.current.onerror=()=>{h(d.NO_RECORDER),g("idle")},i.current.start(),g("recording")):(h(d.UNSUPPORTED_BROWSER),n.v.addAction("getMediaStreamError",{error:d.UNSUPPORTED_BROWSER}))}}),[b,x,h,g]),R=(0,o.useCallback)((()=>{i.current&&"inactive"!==i.current.state&&(g("stopping"),i.current.stop(),p.current&&p.current.getTracks().forEach((e=>e.stop())),u.current&&u.current.getTracks().forEach((e=>e.stop())),c.current=[])}),[g]),C=(0,o.useCallback)((()=>{u.current&&(u.current.getTracks().forEach((e=>e.stop())),u.current=null)}),[]);return(0,o.useEffect)((()=>{(y||v)&&u.current&&(C(),b())}),[y,b,C,v]),{startRecording:O,stopRecording:R,turnVideoOn:P,turnVideoOff:C,previewStream:u.current,exportStream:p,checkPermissionsAndUpdateMediaDevices:I}}!function(e){e.ABORT_ERROR="AbortError",e.NOT_ALLOWED_ERROR="NotAllowedError",e.NOT_FOUND_ERROR="NotFoundError",e.NOT_READABLE_ERROR="NotReadableError",e.OVERCONSTRAINED_ERROR="OverconstrainedError",e.TYPE_ERROR="TypeError",e.NONE="NONE",e.NO_RECORDER="recorder_error",e.UNSUPPORTED_BROWSER="unsupported_browser",e.MIME_TYPE_NOT_SUPPORTED="mime_type_not_supported"}(d||(d={}))},98982:function(e,t,i){i.d(t,{Z:function(){return r}});var n=i(67294);function r(e){const{0:t,1:i}=(0,n.useState)(!1);return(0,n.useEffect)((()=>{e>0&&i(!0)}),[e]),t}},27618:function(e,t,i){let n;i.d(t,{A:function(){return n}}),function(e){e.ADD_TILE="ADD_TILE",e.MOVE_TILE="MOVE_TILE"}(n||(n={}))},22817:function(e,t,i){i.d(t,{z:function(){return d}});var n=i(25934),r=i(51718),o=i(82326);function a(e,t){const{tomeView:i,anonymousView:n}=t;if(null!==n&&void 0!==n&&n.anonymousViews){const t=`Tome:${n.tomeId}`;e.modify({id:t,fields:{anonymousViews:()=>n.anonymousViews}})}if(!i)return;const o=e.identify(i);if(e.readFragment({id:o,fragment:r.bMw,fragmentName:"TomeActivityFragment"}))e.modify({id:o,fields:{lastTimestamp:()=>i.lastTimestamp,lastPresenceType:()=>i.lastPresenceType,active:()=>i.active,pageId:()=>i.pageId}});else{const t=`Tome:${i.tomeId}`;if(e.readFragment({id:t,fragment:r.CIe,fragmentName:"TomeViewsFragment"})){const t=e.writeFragment({id:o,fragment:r.bMw,data:i,fragmentName:"TomeActivityFragment"});e.modify({id:`Tome:${i.tomeId}`,fields:{views(){return[t,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]]}}})}else e.writeFragment({id:t,fragment:r.CIe,data:{__typename:"Tome",id:i.tomeId,views:[i],anonymousViews:0},fragmentName:"TomeViewsFragment"})}}function s(e,t){const i=t.identify(e);if(t.readFragment({id:i,fragment:r.bMw,fragmentName:"TomeActivityFragment"}))t.modify({id:i,fields:{lastTimestamp:()=>e.lastTimestamp,lastPresenceType:()=>e.lastPresenceType,pageId:()=>e.pageId,active:()=>e.active}});else{const n=`Page:${e.pageId}`;if(t.readFragment({id:n,fragment:r.rCt,fragmentName:"PageViewsFragment"})){const o=t.writeFragment({id:i,fragment:r.bMw,data:e,fragmentName:"TomeActivityFragment"});t.modify({id:n,fields:{views(){return[o,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]]}}})}else t.writeFragment({id:n,fragment:r.rCt,data:{__typename:"Page",id:e.pageId,views:[e]},fragmentName:"PageViewsFragment"})}}function l(e,t){const{pageView:i,previousPageView:n}=t;i&&s(i,e),n&&s(n,e)}const d={reportViewPresence:function(e,t,i,s){const d=e.cache.readQuery({query:r.fkZ}),{me:c}=d||{},u=(null===c||void 0===c?void 0:c.id)||t,p=c?{__typename:"User",id:c.id,name:c.name,email:c.email,profileImage:c.profileImage,pending:c.pending,createdAt:"",updatedAt:"",status:c.status,creditsAvailable:0}:{__typename:"User",id:t,name:"anonymous",email:"anonymous",profileImage:null,pending:!1,createdAt:"",updatedAt:"",status:r.J0j.Active,creditsAvailable:0},g=e.cache.readFragment({id:`TomeActivity:${i}_${u}`,fragment:r.bMw,fragmentName:"TomeActivityFragment"}),h=(new Date).toISOString();let f;g&&g.active&&g.pageId&&(f={__typename:"TomeActivity",id:`${i}_${g.pageId}_${u}`,lastPresenceType:r.NgV.TomeView,lastTimestamp:h,tomeId:i,pageId:s,userId:u,user:p,active:!1});const m={__typename:"PresenceEdit",tomeView:{__typename:"TomeActivity",id:`${i}_${u}`,lastPresenceType:r.NgV.TomeView,lastTimestamp:h,tomeId:i,pageId:s,userId:u,user:p,active:!0,isGuest:!1},pageView:{__typename:"TomeActivity",id:`${i}_${s}_${u}`,lastPresenceType:r.NgV.TomeView,lastTimestamp:h,tomeId:i,pageId:s,userId:u,user:p,active:!0,isGuest:!1},previousPageView:f};a(e.cache,m),l(e.cache,m),(0,o.Z)((()=>e.mutate({mutation:r.CHh,variables:{editId:(0,n.Z)(),clientId:t,tomeId:i,type:r.NgV.TomeView,pageId:s}})))},reportWorkspacePresence:function(e,t){const i=e.cache.readQuery({query:r.fkZ});i&&i.me&&e.mutate({mutation:r.CHh,variables:{editId:(0,n.Z)(),clientId:t,type:r.NgV.Workspace},update:(e,t)=>{let{data:i}=t;const n=null===i||void 0===i?void 0:i.reportPresence;"PresenceEdit"===(null===n||void 0===n?void 0:n.__typename)&&(a(e,n),l(e,n))}})},updateTomePresenceWithPresenceEdit:a,updatePagePresenceWithPresenceEdit:l}},77774:function(e,t,i){i.d(t,{I2:function(){return v},Np:function(){return y},XL:function(){return b},Yt:function(){return m},o1:function(){return w},w8:function(){return I}});var n=i(59499),r=i(25934),o=i(7034),a=i(51718),s=i(6748),l=i(60864);function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e,t){return e.cache.readFragment({id:`Page:${t}`,fragment:a.IyH,fragmentName:"PageAttributesFragment"})}function p(e){var t;const i=c(c({},e),{},{page:{overlay:c({},null===(t=e.page)||void 0===t?void 0:t.overlay)}});return delete i.page.overlay.videoUrl,delete i.page.overlay.videoThumbnailUrl,i}function g(e){return c(c({},e),{},{apply:e.apply.map((e=>p(e))),revert:e.revert.map((e=>p(e)))})}function h(e,t,i,n,r){const o=u(t,e),s=[{operation:a.C8.UpdatePage,id:e,page:{overlay:c({},null===o||void 0===o?void 0:o.overlay)}}],{overlay:l}=s[0].page;return null===i?l.videoId=null:void 0!==i&&(l.videoId=i),void 0!==n&&(l.videoStatus=n),r&&(l.position=r),s}function f(e,t,i,n){const r=u(t,e),o=[{operation:a.C8.UpdatePage,id:e,page:{overlay:c({},null===r||void 0===r?void 0:r.overlay)}}],{overlay:s}=o[0].page;return n&&(s.videoStatus=n),null===i?s.videoId=null:void 0!==i&&(s.videoId=i),o}function m(e,t,i,n){const o=h(t,i,void 0,a.Kwn.Uploaded,void 0),l=f(t,i,null,a.Kwn.WaitingForCreation),d={id:(0,r.Z)(),tomeId:e,clientId:n,apply:o,revert:l};(0,s.iO)(i,g(d),d,!0)}function y(e,t,i,n){const d=h(t,i,null,a.Kwn.WaitingForCreation,void 0),c=f(t,i,void 0,void 0),u={id:(0,r.Z)(),tomeId:e,clientId:n,apply:d,revert:c};(0,s.iO)(i,g(u),u),(0,l.ak)({message:o.ZP.t("logic.pageOverlay.recordingDeletedMessage"),action:"undo"})}function v(e,t,i,n,o){const a=h(t,i,void 0,void 0,o),l=f(t,i,void 0,void 0),d={id:(0,r.Z)(),tomeId:e,clientId:n,apply:a,revert:l};(0,s.iO)(i,g(d),d)}function w(e,t,i,n){const o=h(t,i,null,a.Kwn.WaitingForCreation,void 0),l=o,d={id:(0,r.Z)(),tomeId:e,clientId:n,apply:o,revert:l};(0,s.iO)(i,g(d),d)}function b(e,t,i,n,o){const l=h(t,n,i,a.Kwn.WaitingForUpload,void 0),d=l,c={id:(0,r.Z)(),tomeId:e,clientId:o,apply:l,revert:d};(0,s.iO)(n,g(c),c,!0)}function I(e,t,i,n,o,l){const d=h(t,n,i,a.Kwn.Uploaded,void 0),c=f(t,n,null,void 0),u={id:(0,r.Z)(),tomeId:e,clientId:o,apply:d,revert:c};(0,s.iO)(n,g(u),u,!1,l)}},46253:function(e,t,i){i.d(t,{C:function(){return n},X:function(){return r}});const n=e=>{let t=!1;if(e.dataTransfer){const i=e.dataTransfer.types;for(const e in i)if("Files"===i[e]){t=!0;break}}return t};function r(e){return void 0!==e.dataTransfer}},98838:function(e,t,i){function n(e){let{src:t,width:i,quality:n}=e;const r=["auto=format","fit=max",`w=${i}`,"fm=png"];let o="";return n&&r.push(`q=${n}`),r.length&&(o=`?${r.join("&")}`),`${t}${o}`}i.d(t,{Z:function(){return n}})},40105:function(e,t,i){i.d(t,{Z:function(){return s}});var n=i(67294),r=i(59499);class o{constructor(){(0,r.Z)(this,"map",new Map)}get(e){e:for(const[t,i]of this.map)if(t.length===e.length){for(let i=0;i<t.length;i++)if(!Object.is(t[i],e[i]))continue e;return i}}set(e,t){return this.map.set(e,t),t}}var a=function(e){const t=new o;return function i(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=t.get(r);return void 0!==a?a:r.length>=e.length?t.set(r,e.apply(this,r)):t.set(r,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.apply(this,r.concat(t))}))}};var s=function(e,t){return(0,n.useMemo)((()=>a(e)),t)}}}]);
